<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>マルチドメイン・コンバージェンス Top30 4象限マトリックス【{{DATE}}】</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            padding: 20px;
            color: #fff;
        }
        @keyframes glow {
            0%, 100% { filter: drop-shadow(0 0 8px #ffd700); }
            50% { filter: drop-shadow(0 0 16px #ffd700); }
        }
    </style>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        const { useState } = React;

        /*
        マルチドメイン・コンバージェンス分析フレームワーク（100点満点）

        【5軸評価】
        1. 物理的独占力（30点）: 市場シェア、代替不可能性
        2. 政策耐性（20点）: 超党派支持、規制リスク
        3. クロスドメイン・シナジー（25点）: 6ドメイン横断需要
        4. 情報非対称性（15点）: 認識ギャップ、カタリスト
        5. 資本効率（10点）: FCF、希薄化リスク

        【4象限分類】
        - Prime（最優先投資）: certainty>=80 AND upside>=58
        - Stable（安定成長）: certainty>=80 AND upside<58
        - Speculative（投機的機会）: certainty<80 AND upside>=58
        - Avoid（様子見）: certainty<80 AND upside<58
        */

        // プレースホルダー: 実際のデータ生成時に置換される
        const analysisDate = "{{DATE}}";
        const marketRiskScore = {{MARKET_RISK_SCORE}};
        const marketRiskLevel = "{{MARKET_RISK_LEVEL}}";

        const stockData = {{COMPANIES_DATA}};

        const allStocks = stockData;

        // 色の定義
        const domainColors = {
            "AI": "#a855f7",
            "防衛": "#3b82f6",
            "エネルギー": "#22c55e",
            "ロボティクス": "#f97316",
            "宇宙": "#06b6d4",
            "サイバー": "#ec4899",
        };

        const quadrantColors = {
            prime: { bg: "rgba(34, 197, 94, 0.15)", border: "#22c55e", label: "最優先投資" },
            stable: { bg: "rgba(59, 130, 246, 0.15)", border: "#3b82f6", label: "安定成長" },
            speculative: { bg: "rgba(249, 115, 22, 0.15)", border: "#f97316", label: "投機的機会" },
            avoid: { bg: "rgba(239, 68, 68, 0.15)", border: "#ef4444", label: "回避/様子見" },
        };

        function QuadrantChart() {
            const [hoveredStock, setHoveredStock] = useState(null);
            const [selectedDomain, setSelectedDomain] = useState("all");

            const chartWidth = 900;
            const chartHeight = 650;
            const padding = 70;

            const filteredStocks = selectedDomain === "all"
                ? allStocks
                : allStocks.filter(s => s.domain === selectedDomain);

            // 確実性70-100、アップサイド30-85の範囲でスケーリング
            const scaleX = (certainty) => padding + ((certainty - 70) / 30) * (chartWidth - 2 * padding);
            const scaleY = (upside) => chartHeight - padding - ((upside - 30) / 55) * (chartHeight - 2 * padding);

            // 象限の境界線の位置（certainty=80, upside=58）
            const boundaryX = scaleX(80);
            const boundaryY = scaleY(58);

            const domains = [...new Set(allStocks.map(s => s.domain))];

            // ホバー中の銘柄を最後に描画するためにソート
            const sortedStocks = [...filteredStocks].sort((a, b) => {
                if (a.ticker === hoveredStock) return 1;
                if (b.ticker === hoveredStock) return -1;
                return 0;
            });

            // ホバー中の銘柄データを取得
            const hoveredStockData = hoveredStock ? allStocks.find(s => s.ticker === hoveredStock) : null;

            // 象限ごとの企業数
            const quadrantCounts = {
                prime: allStocks.filter(s => s.quadrant === "prime").length,
                stable: allStocks.filter(s => s.quadrant === "stable").length,
                speculative: allStocks.filter(s => s.quadrant === "speculative").length,
                avoid: allStocks.filter(s => s.quadrant === "avoid").length,
            };

            // 市場リスクに応じた色
            const riskColor = marketRiskScore >= 75 ? "#ef4444" : marketRiskScore >= 50 ? "#f97316" : marketRiskScore >= 25 ? "#fbbf24" : "#22c55e";

            return (
                <div style={{ maxWidth: "1200px", margin: "0 auto" }}>
                    <h1 style={{ textAlign: "center", fontSize: "24px", marginBottom: "8px", color: "#fff" }}>
                        マルチドメイン・コンバージェンス分析 Top30【米国企業版】
                    </h1>
                    <h2 style={{ textAlign: "center", fontSize: "16px", marginBottom: "12px", color: "#94a3b8", fontWeight: "normal" }}>
                        4象限マトリックス（確実性 × アップサイド）| {analysisDate}
                    </h2>

                    {/* 市場危険度アラート */}
                    <div style={{ display: "flex", justifyContent: "center", marginBottom: "16px" }}>
                        <div style={{
                            background: `linear-gradient(135deg, ${riskColor}, ${riskColor}99)`,
                            padding: "8px 20px",
                            borderRadius: "20px",
                            fontSize: "13px",
                            fontWeight: "bold",
                            boxShadow: `0 4px 15px ${riskColor}66`
                        }}>
                            市場リスク {marketRiskScore}/100（{marketRiskLevel}）| 評価軸: 独占力(30)+政策耐性(20)+シナジー(25)+非対称性(15)+資本効率(10)
                        </div>
                    </div>

                    {/* フィルター */}
                    <div style={{ display: "flex", justifyContent: "center", gap: "8px", marginBottom: "16px", flexWrap: "wrap" }}>
                        <button
                            onClick={() => setSelectedDomain("all")}
                            style={{
                                padding: "6px 14px",
                                borderRadius: "20px",
                                border: "none",
                                background: selectedDomain === "all" ? "#fff" : "#334155",
                                color: selectedDomain === "all" ? "#1a1a2e" : "#94a3b8",
                                cursor: "pointer",
                                fontSize: "12px",
                                fontWeight: selectedDomain === "all" ? "bold" : "normal"
                            }}
                        >
                            すべて
                        </button>
                        {domains.map(domain => (
                            <button
                                key={domain}
                                onClick={() => setSelectedDomain(domain)}
                                style={{
                                    padding: "6px 14px",
                                    borderRadius: "20px",
                                    border: `1px solid ${domainColors[domain] || "#888"}`,
                                    background: selectedDomain === domain ? (domainColors[domain] || "#888") : "transparent",
                                    color: selectedDomain === domain ? "#fff" : (domainColors[domain] || "#888"),
                                    cursor: "pointer",
                                    fontSize: "12px"
                                }}
                            >
                                {domain}
                            </button>
                        ))}
                    </div>

                    {/* チャート */}
                    <div style={{ position: "relative", background: "#0f172a", borderRadius: "12px", padding: "10px" }}>
                        <svg width={chartWidth} height={chartHeight} style={{ display: "block", margin: "0 auto" }}>
                            {/* 背景の象限 */}
                            <rect x={padding} y={padding} width={boundaryX - padding} height={boundaryY - padding}
                                fill={quadrantColors.speculative.bg} />
                            <rect x={boundaryX} y={padding} width={chartWidth - padding - boundaryX} height={boundaryY - padding}
                                fill={quadrantColors.prime.bg} />
                            <rect x={padding} y={boundaryY} width={boundaryX - padding} height={chartHeight - padding - boundaryY}
                                fill={quadrantColors.avoid.bg} />
                            <rect x={boundaryX} y={boundaryY} width={chartWidth - padding - boundaryX} height={chartHeight - padding - boundaryY}
                                fill={quadrantColors.stable.bg} />

                            {/* 象限ラベル */}
                            <text x={padding + 10} y={padding + 25} fill={quadrantColors.speculative.border} fontSize="13" fontWeight="bold">投機的機会</text>
                            <text x={chartWidth - padding - 100} y={padding + 25} fill={quadrantColors.prime.border} fontSize="13" fontWeight="bold">最優先投資</text>
                            <text x={padding + 10} y={chartHeight - padding - 10} fill={quadrantColors.avoid.border} fontSize="13" fontWeight="bold">回避/様子見</text>
                            <text x={chartWidth - padding - 85} y={chartHeight - padding - 10} fill={quadrantColors.stable.border} fontSize="13" fontWeight="bold">安定成長</text>

                            {/* 境界線 */}
                            <line x1={boundaryX} y1={padding} x2={boundaryX} y2={chartHeight - padding} stroke="#475569" strokeDasharray="4" />
                            <line x1={padding} y1={boundaryY} x2={chartWidth - padding} y2={boundaryY} stroke="#475569" strokeDasharray="4" />

                            {/* 外枠 */}
                            <rect x={padding} y={padding} width={chartWidth - 2 * padding} height={chartHeight - 2 * padding}
                                fill="none" stroke="#475569" strokeWidth="1" />

                            {/* 軸ラベル */}
                            <text x={chartWidth / 2} y={chartHeight - 20} textAnchor="middle" fill="#94a3b8" fontSize="12">
                                確実性（契約確定・シェア安定・競争優位持続）
                            </text>
                            <text x={20} y={chartHeight / 2} textAnchor="middle" fill="#94a3b8" fontSize="12"
                                transform={`rotate(-90, 20, ${chartHeight / 2})`}>
                                アップサイド（非対称性・収斂加速性）
                            </text>

                            {/* 軸目盛り */}
                            {[70, 75, 80, 85, 90, 95, 100].map(v => (
                                <g key={`x-${v}`}>
                                    <line x1={scaleX(v)} y1={chartHeight - padding} x2={scaleX(v)} y2={chartHeight - padding + 5} stroke="#64748b" />
                                    <text x={scaleX(v)} y={chartHeight - padding + 18} textAnchor="middle" fill="#64748b" fontSize="10">{v}</text>
                                </g>
                            ))}
                            {[30, 40, 50, 58, 70, 80].map(v => (
                                <g key={`y-${v}`}>
                                    <line x1={padding - 5} y1={scaleY(v)} x2={padding} y2={scaleY(v)} stroke="#64748b" />
                                    <text x={padding - 10} y={scaleY(v) + 4} textAnchor="end" fill="#64748b" fontSize="10">{v}</text>
                                </g>
                            ))}

                            {/* 銘柄プロット */}
                            {sortedStocks.map((stock) => {
                                const x = scaleX(stock.certainty);
                                const y = scaleY(stock.upside);
                                const color = domainColors[stock.domain] || "#888";
                                const isHovered = hoveredStock === stock.ticker;
                                const isTop1 = stock.rank === 1;
                                const isHighMonopoly = stock.monopoly >= 27;

                                return (
                                    <g key={stock.ticker} style={{ cursor: "pointer" }}>
                                        <circle
                                            cx={x}
                                            cy={y}
                                            r={isTop1 ? 28 : isHighMonopoly ? 24 : isHovered ? 26 : 20}
                                            fill={isTop1 ? `#ffd700cc` : `${color}${isHovered ? "dd" : "99"}`}
                                            stroke={isTop1 ? "#ffd700" : isHighMonopoly ? "#ff6b6b" : isHovered ? "#fff" : color}
                                            strokeWidth={isTop1 ? 3 : isHighMonopoly ? 2 : isHovered ? 3 : 1}
                                            style={{ transition: "all 0.2s" }}
                                            onMouseEnter={() => setHoveredStock(stock.ticker)}
                                            onMouseLeave={() => setHoveredStock(null)}
                                        />
                                        {/* ティッカー */}
                                        <text
                                            x={x}
                                            y={y + 1}
                                            textAnchor="middle"
                                            dominantBaseline="middle"
                                            fill={isTop1 ? "#1a1a2e" : "#fff"}
                                            fontSize={isTop1 ? "9" : isHovered ? "9" : "8"}
                                            fontWeight="bold"
                                            style={{ pointerEvents: "none" }}
                                        >
                                            {stock.ticker}
                                        </text>
                                        {/* 順位 */}
                                        <text
                                            x={x}
                                            y={y - (isTop1 ? 36 : 28)}
                                            textAnchor="middle"
                                            fill={isTop1 ? "#ffd700" : isHighMonopoly ? "#ff6b6b" : "#94a3b8"}
                                            fontSize={isTop1 ? "11" : "9"}
                                            fontWeight={isTop1 || isHighMonopoly ? "bold" : "normal"}
                                            style={{ pointerEvents: "none" }}
                                        >
                                            {isTop1 ? "#1" : `#${stock.rank}`}
                                        </text>
                                    </g>
                                );
                            })}
                        </svg>

                        {/* ホバー情報 */}
                        {hoveredStockData && (
                            <div style={{
                                position: "absolute",
                                top: "20px",
                                right: "20px",
                                background: "#1e293b",
                                border: "1px solid #475569",
                                borderRadius: "8px",
                                padding: "12px",
                                minWidth: "320px",
                                boxShadow: "0 10px 40px rgba(0,0,0,0.5)",
                                zIndex: 100
                            }}>
                                {(() => {
                                    const stock = hoveredStockData;
                                    const color = domainColors[stock.domain] || "#888";
                                    const isHighMonopoly = stock.monopoly >= 27;
                                    return (
                                        <>
                                            <div style={{ display: "flex", alignItems: "center", gap: "8px" }}>
                                                <span style={{ fontSize: "18px", fontWeight: "bold", color: stock.rank === 1 ? "#ffd700" : color }}>
                                                    {stock.ticker}
                                                </span>
                                                {stock.rank === 1 && <span style={{ background: "#ffd700", color: "#000", padding: "2px 6px", borderRadius: "4px", fontSize: "10px" }}>最高評価</span>}
                                                {isHighMonopoly && <span style={{ background: "#ff6b6b", color: "#000", padding: "2px 6px", borderRadius: "4px", fontSize: "10px" }}>高独占</span>}
                                            </div>
                                            <div style={{ fontSize: "14px", color: "#94a3b8", marginBottom: "4px" }}>{stock.name}</div>
                                            <div style={{ fontSize: "11px", color: "#64748b", marginBottom: "8px" }}>{stock.core_tech}</div>

                                            <div style={{ fontSize: "12px", color: "#cbd5e1" }}>
                                                <div style={{ display: "grid", gridTemplateColumns: "1fr 1fr", gap: "4px" }}>
                                                    <div>順位: #{stock.rank}</div>
                                                    <div>総合: {stock.total}点</div>
                                                    <div>確実性: {stock.certainty}</div>
                                                    <div>アップサイド: {stock.upside}</div>
                                                </div>

                                                <div style={{ marginTop: "6px", paddingTop: "6px", borderTop: "1px solid #475569", fontSize: "11px" }}>
                                                    <div>独占力: {stock.monopoly}/30 | 政策耐性: {stock.resilience}/20</div>
                                                    <div>シナジー: {stock.synergy}/25 | 非対称性: {stock.asymmetry}/15</div>
                                                    <div>資本効率: {stock.capital}/10</div>
                                                </div>

                                                <div style={{ marginTop: "6px", color: "#fbbf24" }}>{stock.note}</div>
                                                <div style={{ marginTop: "4px", color: "#94a3b8", fontSize: "10px" }}>{stock.thesis}</div>
                                            </div>
                                        </>
                                    );
                                })()}
                            </div>
                        )}
                    </div>

                    {/* 凡例 */}
                    <div style={{ display: "flex", justifyContent: "center", gap: "16px", marginTop: "16px", flexWrap: "wrap" }}>
                        {Object.entries(domainColors).map(([domain, color]) => (
                            <div key={domain} style={{ display: "flex", alignItems: "center", gap: "6px" }}>
                                <div style={{ width: "12px", height: "12px", borderRadius: "50%", background: color }} />
                                <span style={{ fontSize: "12px", color: "#94a3b8" }}>{domain}</span>
                            </div>
                        ))}
                        <div style={{ display: "flex", alignItems: "center", gap: "6px" }}>
                            <div style={{ width: "12px", height: "12px", borderRadius: "50%", border: "2px solid #ff6b6b", background: "transparent" }} />
                            <span style={{ fontSize: "12px", color: "#ff6b6b" }}>高独占(27+)</span>
                        </div>
                    </div>

                    {/* 評価基準の説明 */}
                    <div style={{
                        marginTop: "16px",
                        background: "rgba(71, 85, 105, 0.3)",
                        border: "1px solid #475569",
                        borderRadius: "8px",
                        padding: "10px",
                        fontSize: "11px",
                        color: "#94a3b8"
                    }}>
                        <div style={{ fontWeight: "bold", marginBottom: "4px" }}>マルチドメイン・コンバージェンス評価フレームワーク（100点満点）</div>
                        <div style={{ display: "grid", gridTemplateColumns: "1fr 1fr 1fr", gap: "8px" }}>
                            <div><span style={{ color: "#ff6b6b" }}>物理的独占力(30点)</span>: 市場シェア + 代替不可能性</div>
                            <div><span style={{ color: "#3b82f6" }}>政策耐性(20点)</span>: 超党派支持 + 規制リスク耐性</div>
                            <div><span style={{ color: "#22c55e" }}>シナジー(25点)</span>: 6ドメイン横断需要 + 相乗効果</div>
                        </div>
                        <div style={{ marginTop: "4px" }}>
                            <span style={{ color: "#f97316" }}>核心の問い</span>: この技術がなくなったら何が止まるか？ / 何社が依存？ / 競合が追いつくのに何年？
                        </div>
                    </div>

                    {/* 最高評価銘柄ハイライト */}
                    {allStocks.length > 0 && (
                        <div style={{
                            marginTop: "16px",
                            background: "linear-gradient(135deg, rgba(255,215,0,0.15), rgba(34,197,94,0.1))",
                            border: "2px solid #ffd700",
                            borderRadius: "10px",
                            padding: "14px"
                        }}>
                            <div style={{ display: "flex", alignItems: "center", gap: "8px", marginBottom: "6px" }}>
                                <span style={{ fontSize: "20px" }}>1</span>
                                <span style={{ fontSize: "16px", fontWeight: "bold", color: "#ffd700" }}>
                                    最高評価銘柄：{allStocks[0].ticker} {allStocks[0].name}
                                </span>
                            </div>
                            <div style={{ fontSize: "12px", color: "#cbd5e1", lineHeight: "1.6" }}>
                                {allStocks[0].thesis}
                            </div>
                        </div>
                    )}

                    {/* 高独占銘柄 */}
                    <div style={{
                        marginTop: "12px",
                        background: "linear-gradient(135deg, rgba(255,107,107,0.1), rgba(239,68,68,0.05))",
                        border: "1px solid #ff6b6b",
                        borderRadius: "10px",
                        padding: "12px"
                    }}>
                        <div style={{ display: "flex", alignItems: "center", gap: "8px", marginBottom: "6px" }}>
                            <span style={{ fontSize: "14px", fontWeight: "bold", color: "#ff6b6b" }}>高独占銘柄（27点以上）</span>
                        </div>
                        <div style={{ display: "grid", gridTemplateColumns: "1fr 1fr 1fr", gap: "8px", fontSize: "11px", color: "#cbd5e1" }}>
                            {allStocks.filter(s => s.monopoly >= 27).map(stock => (
                                <div key={stock.ticker}>
                                    <span style={{ color: "#ff6b6b" }}>{stock.ticker}</span> {stock.name.split(' ')[0]}: {stock.note}
                                </div>
                            ))}
                        </div>
                    </div>

                    {/* 戦略サマリー */}
                    <div style={{ display: "grid", gridTemplateColumns: "repeat(auto-fit, minmax(250px, 1fr))", gap: "12px", marginTop: "20px" }}>
                        <div style={{ background: `${quadrantColors.prime.bg}`, border: `1px solid ${quadrantColors.prime.border}`, borderRadius: "8px", padding: "12px" }}>
                            <div style={{ color: quadrantColors.prime.border, fontWeight: "bold", marginBottom: "4px" }}>最優先投資（Prime）: {quadrantCounts.prime}社</div>
                            <div style={{ fontSize: "11px", color: "#cbd5e1" }}>
                                {allStocks.filter(s => s.quadrant === "prime").map(s => s.ticker).join(", ")}
                            </div>
                        </div>
                        <div style={{ background: `${quadrantColors.stable.bg}`, border: `1px solid ${quadrantColors.stable.border}`, borderRadius: "8px", padding: "12px" }}>
                            <div style={{ color: quadrantColors.stable.border, fontWeight: "bold", marginBottom: "4px" }}>安定成長（Stable）: {quadrantCounts.stable}社</div>
                            <div style={{ fontSize: "11px", color: "#cbd5e1" }}>
                                {allStocks.filter(s => s.quadrant === "stable").map(s => s.ticker).join(", ")}
                            </div>
                        </div>
                        <div style={{ background: `${quadrantColors.speculative.bg}`, border: `1px solid ${quadrantColors.speculative.border}`, borderRadius: "8px", padding: "12px" }}>
                            <div style={{ color: quadrantColors.speculative.border, fontWeight: "bold", marginBottom: "4px" }}>投機的機会（Speculative）: {quadrantCounts.speculative}社</div>
                            <div style={{ fontSize: "11px", color: "#cbd5e1" }}>
                                {allStocks.filter(s => s.quadrant === "speculative").map(s => s.ticker).join(", ") || "該当なし"}
                            </div>
                        </div>
                        <div style={{ background: `${quadrantColors.avoid.bg}`, border: `1px solid ${quadrantColors.avoid.border}`, borderRadius: "8px", padding: "12px" }}>
                            <div style={{ color: quadrantColors.avoid.border, fontWeight: "bold", marginBottom: "4px" }}>回避/様子見（Avoid）: {quadrantCounts.avoid}社</div>
                            <div style={{ fontSize: "11px", color: "#cbd5e1" }}>
                                {allStocks.filter(s => s.quadrant === "avoid").map(s => s.ticker).join(", ") || "Top30内に該当なし"}
                            </div>
                        </div>
                    </div>

                    {/* Key Insights - プレースホルダー */}
                    <div style={{
                        marginTop: "16px",
                        background: "rgba(168, 85, 247, 0.1)",
                        border: "1px solid #a855f7",
                        borderRadius: "10px",
                        padding: "12px"
                    }}>
                        <div style={{ fontSize: "13px", fontWeight: "bold", color: "#a855f7", marginBottom: "8px" }}>Key Insights</div>
                        <div style={{ fontSize: "11px", color: "#cbd5e1", lineHeight: "1.8" }}>
                            {{KEY_INSIGHTS}}
                        </div>
                    </div>

                    <div style={{ textAlign: "center", marginTop: "20px", fontSize: "11px", color: "#64748b" }}>
                        {analysisDate} | マルチドメイン・コンバージェンス分析 | ホバーで詳細表示
                    </div>
                </div>
            );
        }

        ReactDOM.render(<QuadrantChart />, document.getElementById('root'));
    </script>
</body>
</html>
