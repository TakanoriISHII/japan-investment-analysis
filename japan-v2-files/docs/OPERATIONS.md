# OPERATIONS.md - 実行プロトコル

> **対象読者**: オペレーター、分析実行者
> **目的**: 分析の実行手順を定義する

---

## 目次

1. [クイックリファレンス](#クイックリファレンス)
2. [LLM役割分担](#llm役割分担)
3. [コマンド一覧](#コマンド一覧)
4. [フル分析プロトコル](#フル分析プロトコル)
5. [フェーズ独立性と部分再実行](#フェーズ独立性と部分再実行)
6. [情報収集プロセス](#情報収集プロセス)
7. [品質管理ルール](#品質管理ルール)
8. [継続的改善サイクル](#継続的改善サイクル)

---

## クイックリファレンス

| やりたいこと | コマンド | 参照セクション |
|-------------|---------|---------------|
| フル分析を実行 | `分析を実行` | [フル分析プロトコル](#フル分析プロトコル) |
| 特定フェーズから再開 | `分析を実行 --from [phase]` | [部分再実行](#フェーズ独立性と部分再実行) |
| 状態を確認 | `状態を確認` | - |
| 企業をスコアリング | `ボトルネック評価を実行` | [METHODOLOGY.md](./METHODOLOGY.md) |
| 市場環境を判断 | `市場危険度を分析` | [METHODOLOGY.md](./METHODOLOGY.md) |
| 情報を検証 | `Gap分析を実行` | [品質管理ルール](#品質管理ルール) |
| 改善タスクを確認 | `show pending tasks` | [継続的改善サイクル](#継続的改善サイクル) |
| 前回との差分を確認 | `差分レポート` | [差分追跡](#差分追跡) |

---

## LLM役割分担

### LLM特性テーブル

| LLM | 速度 | 強み | 弱み | 適したタスク |
|-----|------|------|------|-------------|
| **Grok** | ★★★★★ 最速 | リアルタイム情報、大量処理 | 深い分析はやや弱い | 広域情報、大量の補強タスク |
| **Gemini** | ★★★☆☆ やや遅い | 包括的収集、広範囲発掘 | 処理時間がかかる | 企業情報、カバレッジ補強 |
| **ChatGPT** | ★★☆☆☆ 遅い | 深い分析、構造化 | 途中で止まりやすい | 限定的な深掘りタスクのみ |
| **Claude** | ★★★★☆ 自動 | 一次情報源確認、矛盾解消、Web検索 | - | 自動補強、統合、分析 |

### 初回情報収集の役割分担

```
┌─────────────────────────────────────────────────────────────────┐
│                    初回情報収集（Phase 2）                       │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  【企業情報】prompt_company_info.md                             │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ Grok   → 企業発掘（高速・広範囲スキャン）              │   │
│  │ Gemini → 企業詳細（包括的な財務・競争分析）            │   │
│  │ ChatGPT → 深い分析（限定的使用）                       │   │
│  │ Claude → 自動で独自視点収集（Web検索）                 │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│  【広域情報】prompt_broad_info.md                               │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ Grok   → リアルタイム市場情報、地政学、センチメント    │   │
│  │ Gemini → メガトレンド、政策動向（包括的）              │   │
│  │ ChatGPT → 深い分析（限定的使用）                       │   │
│  │ Claude → 自動で独自視点収集（Web検索）                 │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│  【収集ファイル合計: 8ファイル】                                │
│  - company_info: grok_cd.md, gemini_cd.md, gpt_cd.md, claude_cd.md │
│  - broad_info: grok_mi.md, gemini_mi.md, chatgpt_mi.md, claude_mi.md │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### タスク割り当てルール

| タスク数 | 割り当て |
|---------|---------|
| 1-3件 | Claude自動 + Gemini |
| 4-10件 | Claude自動 + Grok（大半）+ Gemini（重要タスク）|
| 11件以上 | Claude自動 + Grok（全て）|

| タスクタイプ | 担当LLM | 理由 |
|-------------|---------|------|
| 一次情報源確認 | **Claude（自動）** | Web検索で直接確認可能 |
| 矛盾解消 | **Claude（自動）** | 即座に検証が必要 |
| カバレッジ補強 | **Grok** | 大量スキャンが必要、最速 |
| リアルタイム更新 | **Grok** | リアルタイム情報に強い |
| 企業深掘り | **Gemini** | 包括的分析が得意 |
| 技術分析 | **Gemini** | 詳細な構造化が得意 |
| 複雑な論理分析 | **ChatGPT** | 深い分析が必要な場合のみ |

---

## コマンド一覧

### 基本コマンド

| コマンド | アクション |
|---------|----------|
| `分析を実行` | フル分析（フェーズ1-9）を実行 |
| `状態を確認` | 全ファイル状態と分析状態を表示 |
| `差分レポート` | 前回分析からの変更を表示 |

### 分析コマンド

| コマンド | アクション |
|---------|----------|
| `情報を読み込み` | raw/配下の全ファイルを読み込み |
| `企業を統合` | 各LLMの企業情報を統合し、重複排除 |
| `Gap分析を実行` | カバレッジ不足を確認、補足調査 |
| `ボトルネック評価を実行` | 5軸スコアリングを実行 |
| `Top30を選出` | ランク付けしTop 30 + ウォッチリストを選定 |
| `市場危険度を分析` | 市場リスクスコアを計算 |
| `レポートを生成` | 最終レポートをreports/に出力 |

### 継続的改善コマンド

| コマンド | アクション |
|---------|----------|
| `show quality issues` | 情報品質レポートの改善ポイントを表示 |
| `generate reinforcement prompts` | 改善プロンプトを自動生成 |
| `run reinforcement [priority]` | 指定優先度の補強調査を実行（1/2/3/all） |
| `show pending tasks` | 未実施の補強タスクを表示 |
| `update stable [type]` | 蓄積情報を更新（permanent/quarterly/monthly） |

---

## フル分析プロトコル

> **【必須】フェーズ実行ルール**: 各フェーズ開始時に、OPERATIONS.mdのチェックリストをTodoWriteで展開し、全項目完了を確認してから次フェーズに進むこと。

### 「分析を実行」時のフロー

```
┌─────────────────────────────────────────────────────────────────┐
│                     フル分析: 9フェーズ                         │
├─────────────────────────────────────────────────────────────────┤
│ Phase 1: 状態確認                    → 前回状態を把握          │
│ Phase 2: インテリジェンス収集        → 4LLM並列実行            │
│ Phase 3: 比較分析                    → 矛盾・ギャップ検出      │
│ Phase 4: 補足調査                    → Claudeで深掘り          │
│ Phase 5: 統合・確度整理              → 全情報マージ            │
│ Phase 6: 分析・評価                  → スコアリング            │
│ Phase 7: レポート生成                → 出力作成                │
│ Phase 8: 継続的改善                  → 補強タスク生成          │
│ Phase 9: 完了                        → 状態更新・push          │
└─────────────────────────────────────────────────────────────────┘
```

---

### Phase 1: 状態確認

```
目的: 前回の分析状態を把握し、継続性を確保する

1. data/state.json を読み込み
2. 前回実行日時、コンポーネント状態を確認
3. 未完了の補強タスクを確認（reinforcement/pending_tasks.json）
```

#### ✅ Phase 1 完了チェックリスト

| # | 確認項目 | 確認内容 |
|---|---------|---------|
| 1-1 | state.json確認 | 前回実行日時、最終完了フェーズを把握した |
| 1-2 | 品質アラート確認 | 前回の改善ポイントをレビューした |
| 1-3 | 未完了タスク確認 | pending_tasks.jsonの残タスクを把握した |
| 1-4 | 補強結果確認 | reinforcement/results/に新規結果があれば確認した |

---

### Phase 2: 並列インテリジェンス収集（手動 + Claude自動）

```
目的: 各プロンプトを複数LLMで実行し、冗長性と多様性を確保

【手動実行】外部LLM（Grok + Gemini + ChatGPT）

2-1. 企業情報（prompt_company_info.md）
   - Grok   → data/intelligence/raw/company_info/grok_cd.md
   - Gemini → data/intelligence/raw/company_info/gemini_cd.md
   - ChatGPT → data/intelligence/raw/company_info/gpt_cd.md

2-2. 広域情報（prompt_broad_info.md）
   - Grok   → data/intelligence/raw/broad_info/grok_mi.md
   - Gemini → data/intelligence/raw/broad_info/gemini_mi.md
   - ChatGPT → data/intelligence/raw/broad_info/chatgpt_mi.md

【自動実行】Claude

2-3. Claude情報収集（自動）
   - 企業情報 → data/intelligence/raw/company_info/claude_cd.md
   - 広域情報 → data/intelligence/raw/broad_info/claude_mi.md
   ※Web検索を使用して独自視点・情報源から収集
```

#### ✅ Phase 2 完了チェックリスト

| # | 確認項目 | 確認内容 |
|---|---------|---------|
| 2-1 | Grok企業情報 | `raw/company_info/grok_cd.md` が存在し、内容が有効 |
| 2-2 | Grok広域情報 | `raw/broad_info/grok_mi.md` が存在し、内容が有効 |
| 2-3 | Gemini企業情報 | `raw/company_info/gemini_cd.md` が存在し、内容が有効 |
| 2-4 | Gemini広域情報 | `raw/broad_info/gemini_mi.md` が存在し、内容が有効 |
| 2-5 | Claude企業情報 | `raw/company_info/claude_cd.md` を生成した |
| 2-6 | Claude広域情報 | `raw/broad_info/claude_mi.md` を生成した |
| 2-7 | 最低3ファイル | 最低でも3つのLLM出力が揃っている |

---

### Phase 3: 比較分析

```
目的: LLM間の出力を比較し、情報の信頼性を評価する

3-1. 矛盾検出
   - 同一企業で異なる市場シェア数値
   - 同一イベントで異なる日付/内容
   - 出力: data/analysis/contradictions.json

3-2. ギャップ検出
   - LLM Aにあり、Bにない企業/情報
   - ドメインの偏り（例: 宇宙が少ない）
   - 出力: data/analysis/gaps.json

3-3. 情報確度の初期評価
   ┌─────────────────────────────────────┐
   │ 4LLM一致 → 最高確度（分析に使用）  │
   │ 3LLM一致 → 高確度（分析に使用）    │
   │ 2LLM一致 → 中確度（補足調査推奨）  │
   │ 1LLMのみ → 要検証（補足調査対象）  │
   │ 矛盾あり → 要解消（一次情報源確認）│
   └─────────────────────────────────────┘
```

#### ✅ Phase 3 完了チェックリスト

| # | 確認項目 | 確認内容 |
|---|---------|---------|
| 3-1 | 矛盾検出 | `contradictions.json` を生成/更新した |
| 3-2 | ギャップ検出 | `gaps.json` を生成/更新した |
| 3-3 | 矛盾件数記録 | 検出した矛盾件数: ___件 |
| 3-4 | ギャップ件数記録 | 検出したギャップ件数: ___件 |
| 3-5 | 確度分布記録 | 4LLM一致: ___件、3LLM一致: ___件、要検証: ___件 |

---

### Phase 4: Claude補足調査

```
目的: 矛盾を解消し、ギャップを補完する

4-1. 矛盾解消調査
   - 一次情報源（EDINET, 経産省, 防衛省）で検証
   - 正しい値を特定、誤情報を除外

4-2. ギャップ補完調査
   - 不足ドメイン/企業のWeb検索
   - 見落とされた重要企業の発掘

4-3. 要検証項目の深掘り
   - 1LLMのみの情報を検証
   - 確度を上げるか、除外するか判断

4-4. 出力
   - data/intelligence/claude_supplemental.md

git commit "比較分析・補足調査完了"
```

#### ✅ Phase 4 完了チェックリスト

| # | 確認項目 | 確認内容 |
|---|---------|---------|
| 4-1 | 矛盾解消 | 全矛盾を一次情報源で検証した（解消: ___件 / 全___件） |
| 4-2 | ギャップ補完 | 重要ギャップをWeb検索で補完した |
| 4-3 | 要検証項目 | 単一LLM情報の検証/除外を判断した |
| 4-4 | 補足調査出力 | `claude_supplemental.md` を生成した |
| 4-5 | コミット | 「比較分析・補足調査完了」でコミットした |

---

### Phase 5: 統合・確度整理

```
目的: 全情報をマージし、4次元評価を付与し、stable/を更新する
```

#### 5-1. 鮮度タグによる情報分類

LLM出力から鮮度タグ（`[PERMANENT]`, `[QUARTERLY]`, `[MONTHLY]`, `[REALTIME]`）を抽出:

```
┌─────────────────────────────────────────────────────────────────────┐
│                    鮮度タグ → stable/への振り分け                    │
├─────────────────────────────────────────────────────────────────────┤
│  [PERMANENT] 認証、モート、競争構造、参入障壁                       │
│     → stable/permanent/companies.json, domains.json                 │
│                                                                     │
│  [QUARTERLY] 財務、市場シェア、ガイダンス                           │
│     → stable/quarterly/financials.json, market_share.json           │
│                                                                     │
│  [MONTHLY] 契約、投資、プロジェクト進捗                             │
│     → stable/monthly/contracts.json, investments.json               │
│                                                                     │
│  [REALTIME] 速報、センチメント                                      │
│     → 分析に直接使用（stableには保存しない）                        │
└─────────────────────────────────────────────────────────────────────┘
```

#### 5-2. 全情報をマージ

```
【重要】stable/と今回LLM収集の関係:

stable/は「ベースライン」として使用し、LLM収集で「変化」を検知する。
変化が検出された場合は、検証の上でstable/を更新する。

優先順位（高い順）:
1. 一次情報源で確認済み（EDINET, 経産省, 防衛省）
2. 今回のLLM収集（4LLM一致）← 高確度の新規情報を優先
3. stable/permanent（認証・参入障壁等の静的情報）
4. 今回のLLM収集（3LLM一致）
5. stable/quarterly（四半期情報）
6. stable/monthly（月次情報）
7. 今回のLLM収集（2LLM以下）
8. reinforcement/results/（補強調査結果）
```

#### 5-3. stable/の更新

| ディレクトリ | 更新条件 | 更新内容 |
|-------------|---------|---------|
| `permanent/` | 新規・変更のみ | 認証、モート、競争構造、参入障壁 |
| `quarterly/` | 四半期決算後 | 財務、市場シェア、ガイダンス |
| `monthly/` | 毎回 | 契約、投資、プロジェクト進捗 |

#### ✅ Phase 5 完了チェックリスト

| # | 確認項目 | 確認内容 |
|---|---------|---------|
| 5-1 | 企業統合 | `consolidated_companies.json` を生成した（___社） |
| 5-2 | 広域統合 | `consolidated_broad.json` を生成した（___項目） |
| 5-3 | permanent更新 | 新規PERMANENT情報を `stable/permanent/` に追加した |
| 5-4 | quarterly更新 | 新規QUARTERLY情報を `stable/quarterly/` に更新した |
| 5-5 | monthly更新 | 新規契約を `stable/monthly/contracts.json` に追加した |
| 5-6 | クリーニング | 3ヶ月以上古いmonthly/データを削除/昇格した |
| 5-7 | コミット | 「統合完了: N社、M情報項目、stable更新」でコミットした |

---

### Phase 6: 分析・評価

```
目的: 統合データから候補を評価し、Top 30を選定する

6-1. 候補プール作成
   - 統合データから50社
   - ドメインカバレッジバランスを確認

6-2. 市場リスク分析（METHODOLOGY.mdに従う）
   - Tier別9カテゴリースコアリング（100点）
   - data/analysis/market_risk.json

6-3. 国際情勢評価
   - 地政学リスク評価
   - 政策変更リスク評価

6-4. Top 30スコアリング（METHODOLOGY.mdに従う）
   - ボトルネック独占評価（100点）
   - 情報確度を考慮した重み付け
   - 50社をランク付け → Top 30 + ウォッチリスト
   - data/analysis/top30.json

6-5. シナリオ分析
   - ベース/ブル/ベアの3シナリオ
   - 各シナリオでのTop30影響評価
```

#### ✅ Phase 6 完了チェックリスト

| # | 確認項目 | 確認内容 |
|---|---------|---------|
| 6-1 | 候補プール | 50社以上の候補をリストアップした |
| 6-2 | 市場リスク | `market_risk.json` を生成した（スコア: ___/100） |
| 6-3 | 国際情勢 | 4地域（米中、台湾、中東、欧州）を評価した |
| 6-4 | Top 30選定 | `top30.json` を生成した（30社 + ウォッチリスト） |
| 6-5 | 5軸スコア | 全Top 30銘柄の5軸スコアを算出した |
| 6-6 | シナリオ分析 | ベース/ブル/ベアの3シナリオを作成した |
| 6-7 | ドメインバランス | 6ドメインのカバレッジを確認した |

---

### Phase 7: レポート生成

```
目的: 分析結果を読みやすい形式で出力する
```

#### 7-1. 最終レポート（final_report.md）

**必須9部構成**（この構成は毎回維持すること）:

```
┌─────────────────────────────────────────────────────────────────────────┐
│ 第1部: 市場環境評価                                                      │
│   ├── 1.1 市場リスクスコア表（9カテゴリ、前回比付き）                   │
│   ├── 📊 推奨投資スタンス（スコア範囲表 + 具体的行動指針）【必須】     │
│   ├── 1.2 歴史的類似                                                    │
│   └── 1.3 シナリオ分析（ベース/ブル/ベア）                              │
├─────────────────────────────────────────────────────────────────────────┤
│ 第2部: 国際情勢評価【必須】                                              │
│   ├── 米中関係（評価: 🟢🟡🟠）                                          │
│   ├── 台湾海峡（評価: 🟢🟡🟠）                                          │
│   ├── 中東・エネルギー（評価: 🟢🟡🟠）                                  │
│   └── 欧州・ウクライナ（評価: 🟢🟡🟠）                                  │
├─────────────────────────────────────────────────────────────────────────┤
│ 第3部: 重要な新規情報                                                    │
│   └── 今回収集した重要な情報（企業固有、契約、政策等）                  │
├─────────────────────────────────────────────────────────────────────────┤
│ 第4部: 6ドメイン成長予測                                                 │
│   └── ドメイン別市場規模・CAGR・ボトルネック                           │
├─────────────────────────────────────────────────────────────────────────┤
│ 第5部: 大型投資パイプライン                                              │
│   └── 主要プロジェクト、防衛予算、ハイパースケーラーCapEx              │
├─────────────────────────────────────────────────────────────────────────┤
│ 第6部: Top 30 銘柄詳細【必須】                                           │
│   ├── 象限別分布                                                        │
│   ├── Top 30 一覧（5軸スコア内訳 + 今回の更新）【必須】                │
│   └── ウォッチリスト（ステータス付き）【必須】                         │
├─────────────────────────────────────────────────────────────────────────┤
│ 第7部: 重大な発見【必須】                                                │
│   └── 継続監視事項 + 新規発見事項（発見日、詳細、影響、ステータス）    │
├─────────────────────────────────────────────────────────────────────────┤
│ 第8部: 監視項目                                                          │
│   ├── 短期（1-3ヶ月）                                                   │
│   ├── 中期（3-6ヶ月）                                                   │
│   └── 長期（6-12ヶ月）                                                  │
├─────────────────────────────────────────────────────────────────────────┤
│ 第9部: 前回からの変更サマリー                                            │
│   └── 主要項目の前回比較表                                              │
└─────────────────────────────────────────────────────────────────────────┘
```

#### 7-2. エグゼクティブサマリー（executive_summary.md）

- 市場リスクスコア表 + 投資スタンス表（簡潔版）
- 主要マクロ指標
- Top 5 コンビクション銘柄
- 重要な新規情報（ハイライト）
- 前回からの変更点

#### 7-3. 情報品質レポート

```
   - reports/[TODAY]/information_quality_report.md
   - 使用情報源、確度分布、矛盾解消記録
   - 【重要】改善ポイントの特定:
     ┌────────────────────────────────────────┐
     │ 品質分析項目:                          │
     │ - カバレッジ不足（ドメイン/企業）      │
     │ - 確度不足（単一情報源のみ）           │
     │ - 矛盾未解消                           │
     │ - 深さ不足（表面的情報のみ）           │
     │ - 鮮度切れ（要更新情報）               │
     └────────────────────────────────────────┘
```

#### 7-4. HTML可視化

- reports/[TODAY]/quadrant_chart.html
- 4象限マトリックス（確実性 × アップサイド）

#### 7-5. latest/にコピー

```
git commit "レポート生成完了"
```

#### ✅ Phase 7 完了チェックリスト

| # | 確認項目 | 確認内容 |
|---|---------|---------|
| 7-1 | 最終レポート | `reports/[DATE]/final_report.md` を生成した（9部構成） |
| 7-2 | サマリー | `reports/[DATE]/executive_summary.md` を生成した |
| 7-3 | 品質レポート | `reports/[DATE]/information_quality_report.md` を生成した |
| 7-4 | 象限チャート | `reports/[DATE]/quadrant_chart.html` を生成した |
| 7-5 | latest更新 | `latest/` フォルダを更新した |
| 7-6 | 品質スコア | 全体品質スコア: ___/100 |
| 7-7 | 要改善カテゴリ | スコア<85のカテゴリ: ___ |
| 7-8 | コミット | 「レポート生成完了」でコミットした |

---

### Phase 8: 継続的改善（Claude自動補強 + 外部LLMタスク生成）

```
目的: 情報品質レポートから改善タスクを生成し、プロンプトを改善する

═══════════════════════════════════════════════════════════════════
8-1. Claude自動補強（即時実行）
═══════════════════════════════════════════════════════════════════

情報品質レポートで以下が検出された場合、Claudeが自動でWeb検索・補強:

【自動補強対象】
┌────────────────────────────────────────────────────────────────┐
│ ✓ 一次情報源での検証が必要な項目                              │
│   → EDINET, 経産省, 防衛省, 原子力規制委員会で直接確認       │
│                                                                │
│ ✓ 矛盾が検出された数値・情報                                  │
│   → Web検索で正しい値を特定、誤情報を除外                    │
│                                                                │
│ ✓ 高非対称性（スコア13+）の情報                               │
│   → 追加検証で確度を上げる                                    │
│                                                                │
│ ✓ Top 30候補の単一情報源項目                                  │
│   → 重要度が高いため優先的に検証                              │
└────────────────────────────────────────────────────────────────┘

【出力】
→ reinforcement/results/claude_auto/[DATE].md
→ 結果は自動でconsolidated_*.jsonに統合

═══════════════════════════════════════════════════════════════════
8-2. 外部LLM用プロンプト生成（手動実行用）
═══════════════════════════════════════════════════════════════════

Claude自動補強で対応できないタスクをLLM別に振り分け:

【Grok用】reinforcement/prompts/grok/
┌────────────────────────────────────────────────────────────────┐
│ - カバレッジ補強（不足ドメインの企業スキャン）                │
│ - リアルタイム情報の更新                                      │
│ - 大量の確度補強タスク（10件以上）                            │
│ - 新規候補発掘                                                │
└────────────────────────────────────────────────────────────────┘

【Gemini用】reinforcement/prompts/gemini/
┌────────────────────────────────────────────────────────────────┐
│ - 企業詳細の深掘り（財務、競争構造）                          │
│ - 技術分析（認証、特許、モート）                              │
│ - 重要度の高い確度補強（5-10件）                              │
└────────────────────────────────────────────────────────────────┘

═══════════════════════════════════════════════════════════════════
8-3. 学習記録
═══════════════════════════════════════════════════════════════════

→ reinforcement/learnings/[DATE].json
→ 精度トラッキング、検出遅延、プロンプト改善提案を記録

git commit "Claude自動補強完了・外部LLMタスク生成"
```

#### ✅ Phase 8 完了チェックリスト

| # | 確認項目 | 確認内容 |
|---|---------|---------|
| 8-1 | Claude自動補強 | `reinforcement/results/claude_auto/[DATE].md` を生成した |
| 8-2 | 学習記録 | `reinforcement/learnings/[DATE].json` を生成した |
| 8-3 | 収集プロンプト改善 | スコア<85のカテゴリのプロンプトを強化した |
| 8-4 | Grokタスク生成 | `reinforcement/prompts/grok/[DATE]_tasks.md` を生成した（該当あれば） |
| 8-5 | Geminiタスク生成 | `reinforcement/prompts/gemini/[DATE]_tasks.md` を生成した（該当あれば） |
| 8-6 | pending更新 | `reinforcement/pending_tasks.json` を更新した |
| 8-7 | コミット | 「Claude自動補強完了・外部LLMタスク生成」でコミットした |

---

### Phase 9: 完了

```
目的: 状態を更新し、分析サイクルを完了する

- state.json を更新
- latest/ フォルダを更新
- 次回分析への引き継ぎ情報を記録
- git commit & push
```

#### ✅ Phase 9 完了チェックリスト

| # | 確認項目 | 確認内容 |
|---|---------|---------|
| 9-1 | state.json | `data/state.json` を更新した（日時、完了フェーズ） |
| 9-2 | latest更新 | `latest/` を最新レポートで更新した |
| 9-3 | 最終コミット | 全変更をコミットした |
| 9-4 | プッシュ | リモートにプッシュした |
| 9-5 | 次回引継ぎ | 次回分析への監視項目を記録した |

---

### 📋 フル分析完了サマリーテンプレート

フル分析終了時に以下を記録:

```markdown
## フル分析完了サマリー: [DATE]

### 実行結果
| フェーズ | 状態 | 備考 |
|---------|------|------|
| Phase 1 | ✅ | - |
| Phase 2 | ✅ | Grok/Gemini/ChatGPT/Claude 8ファイル |
| Phase 3 | ✅ | 矛盾___件、ギャップ___件 |
| Phase 4 | ✅ | 矛盾解消___件 |
| Phase 5 | ✅ | ___社統合、stable更新 |
| Phase 6 | ✅ | 市場リスク___/100 |
| Phase 7 | ✅ | 品質スコア___/100 |
| Phase 8 | ✅ | 補強タスク___件 |
| Phase 9 | ✅ | push完了 |

### 主要アウトプット
- 市場リスクスコア: ___/100（前回比: ±___）
- 情報品質スコア: ___/100
- Top 30変動: 追加___社、除外___社

### 次回への引継ぎ
- 監視項目: ___
- 未完了タスク: ___
```

---

## フェーズ独立性と部分再実行

### フェーズ入出力定義

| Phase | 入力ファイル | 出力ファイル | 独立実行条件 |
|-------|-------------|-------------|-------------|
| 1 | - | state.json（読取） | 常に可能 |
| 2 | prompts/*.md | raw/*.md | 常に可能 |
| 3 | raw/*.md | contradictions.json, gaps.json | Phase 2完了 |
| 4 | contradictions.json, gaps.json | claude_supplemental.md | Phase 3完了 |
| 5 | raw/*.md, claude_supplemental.md, stable/* | consolidated_*.json | Phase 2,4完了 |
| 6 | consolidated_*.json | market_risk.json, top30.json | Phase 5完了 |
| 7 | top30.json, market_risk.json | reports/* | Phase 6完了 |
| 8 | information_quality_report.md | reinforcement/* | Phase 7完了 |
| 9 | 全出力 | state.json（更新） | Phase 7完了 |

### 部分再実行コマンド

```bash
# 特定フェーズから再開（それ以降を全て実行）
分析を実行 --from 5    # Phase 5から再開
分析を実行 --from 6    # Phase 6から再開

# 特定フェーズのみ再実行
run phase 2              # Phase 2のみ再実行
run phase 6              # Phase 6のみ再実行
```

---

## 品質管理ルール

### 矛盾検出ルール

| ルール | トリガー | アクション |
|--------|---------|-----------|
| 数値乖離 | 同一企業、同一指標が10%以上乖離 | 矛盾アラート、一次情報源で検証 |
| タイムライン矛盾 | 「契約締結」の後に「交渉中」 | 日付と内容を再検証 |
| 因果矛盾 | イベント間で因果関係が矛盾 | 両情報源を再検証 |

### 陳腐化検出ルール

| 情報タイプ | 閾値 | アクション |
|-----------|------|-----------|
| 市場シェアデータ | 180日超 | 陳腐化アラート |
| 政策情報 | 実行期限経過 | 結果を確認 |
| ガイダンス | 次の決算後 | 更新必要 |
| 市場状態 | 1日超 | 各分析で更新 |

### 確実性自動調整ルール

| 条件 | 調整 |
|------|------|
| single_unverified が7日経過 | certainty.score -10% |
| 一次情報源で確認 | primary_confirmed にアップグレード、スコア +15 |
| 矛盾発見 | conflicting に変更、スコア -50% |

---

## 継続的改善サイクル

### 改善サイクルの流れ

```
┌──────────────────────────────────────────────────────────────────┐
│   フル分析                                                       │
│      ↓                                                           │
│   情報品質レポート生成                                           │
│      ↓                                                           │
│   ┌────────────────────────────────────────┐                    │
│   │ 品質レポートが特定する改善ポイント:    │                    │
│   │ - カバレッジ不足（ドメイン、企業）     │                    │
│   │ - 確度不足（単一情報源のみ）           │                    │
│   │ - 矛盾未解消（複数情報源で食い違い）   │                    │
│   │ - 深さ不足（表面的な情報のみ）         │                    │
│   └────────────────────────────────────────┘                    │
│      ↓                                                           │
│   ┌──────────────────────────────────────────────────────┐      │
│   │ 【自動】Claude自動補強                                │      │
│   │ - 一次情報源での検証（EDINET, 経産省）               │      │
│   │ - 矛盾解消（Web検索で正しい値を特定）                │      │
│   │ - 高非対称性情報の追加検証                           │      │
│   │ → reinforcement/results/claude_auto/                 │      │
│   └──────────────────────────────────────────────────────┘      │
│      ↓                                                           │
│   ┌──────────────────────────────────────────────────────┐      │
│   │ 【手動】外部LLM用プロンプト生成                       │      │
│   │ - Grok用: カバレッジ補強、大量タスク                 │      │
│   │ - Gemini用: 企業深掘り、技術分析                     │      │
│   │ → reinforcement/prompts/[LLM]/                       │      │
│   └──────────────────────────────────────────────────────┘      │
│      ↓                                                           │
│   次回フル分析で統合                                             │
│      → 補強情報が高確度情報として組み込まれる                   │
└──────────────────────────────────────────────────────────────────┘
```

---

## 関連ドキュメント

- [STRATEGY.md](./STRATEGY.md) - 戦略・理念
- [METHODOLOGY.md](./METHODOLOGY.md) - 評価フレームワーク
- [TECHNICAL_SPEC.md](./TECHNICAL_SPEC.md) - 技術仕様
