# OPERATIONS.md - 実行プロトコル

> **対象読者**: オペレーター、分析実行者
> **目的**: 分析の実行手順を定義する

---

## 目次

1. [クイックリファレンス](#クイックリファレンス)
2. [LLM役割分担](#llm役割分担)
3. [コマンド一覧](#コマンド一覧)
4. [フル分析プロトコル](#フル分析プロトコル)
5. [フェーズ独立性と部分再実行](#フェーズ独立性と部分再実行)
6. [並列実行の最適化](#並列実行の最適化)
7. [情報収集プロセス](#情報収集プロセス)
8. [品質管理ルール](#品質管理ルール)
9. [継続的改善サイクル](#継続的改善サイクル)

---

## クイックリファレンス

| やりたいこと | コマンド | 参照セクション |
|-------------|---------|---------------|
| フル分析を実行 | `run analysis` | [フル分析プロトコル](#フル分析プロトコル) |
| 特定フェーズから再開 | `run analysis --from [phase]` | [部分再実行](#フェーズ独立性と部分再実行) |
| 特定フェーズのみ再実行 | `run phase [N]` | [部分再実行](#フェーズ独立性と部分再実行) |
| 状態を確認 | `check status` | - |
| 企業をスコアリング | `score companies` | [METHODOLOGY.md](./METHODOLOGY.md) |
| 市場環境を判断 | `analyze market risk` | [METHODOLOGY.md](./METHODOLOGY.md) |
| 情報を検証 | `run gap analysis` | [品質管理ルール](#品質管理ルール) |
| 改善タスクを確認 | `show pending tasks` | [継続的改善サイクル](#継続的改善サイクル) |
| 前回との差分を確認 | `diff report` | [差分追跡](#差分追跡) |

---

## LLM役割分担

### LLM特性テーブル

| LLM | 速度 | 強み | 弱み | 適したタスク |
|-----|------|------|------|-------------|
| **Grok** | ★★★★★ 最速 | リアルタイム情報、大量処理 | 深い分析はやや弱い | 広域情報、大量の補強タスク |
| **Gemini** | ★★★☆☆ やや遅い | 包括的収集、広範囲発掘 | 処理時間がかかる | 企業情報、カバレッジ補強 |
| **ChatGPT** | ★★☆☆☆ 遅い | 深い分析、構造化 | 途中で止まりやすい | 限定的な深掘りタスクのみ |
| **Claude** | ★★★★☆ 自動 | 一次情報源確認、矛盾解消、Web検索 | - | 自動補強、統合、分析 |

### 初回情報収集の役割分担

```
┌─────────────────────────────────────────────────────────────────┐
│                    初回情報収集（Phase 2）                       │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  【企業情報】prompt_company_info.md                             │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ Grok   → 企業発掘（高速・広範囲スキャン）              │   │
│  │ Gemini → 企業詳細（包括的な財務・競争分析）            │   │
│  │ Claude → 自動で独自視点収集（Web検索）                 │   │
│  └─────────────────────────────────────────────────────────┘   │
│  ※ChatGPTは使用しない（遅く、止まるリスク）                    │
│                                                                 │
│  【広域情報】prompt_broad_info.md                               │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ Grok   → リアルタイム市場情報、地政学、センチメント    │   │
│  │ Gemini → メガトレンド、政策動向（包括的）              │   │
│  │ Claude → 自動で独自視点収集（Web検索）                 │   │
│  └─────────────────────────────────────────────────────────┘   │
│  ※ChatGPTは使用しない（遅く、止まるリスク）                    │
│                                                                 │
│  【収集ファイル合計: 6ファイル】                                │
│  - company_info: grok.md, gemini.md, claude.md                  │
│  - broad_info: grok.md, gemini.md, claude.md                    │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### 補強調査の役割分担

```
┌─────────────────────────────────────────────────────────────────┐
│                    補強調査（Phase 8 + オプション）              │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  【Claude自動補強】（即時実行）                                 │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ ✓ 一次情報源での検証（有報、TDnet、官報）              │   │
│  │ ✓ 矛盾解消（Web検索で正しい値を特定）                  │   │
│  │ ✓ 数値確認（市場シェア、契約金額）                     │   │
│  │ ✓ 高非対称性情報の追加検証                             │   │
│  └─────────────────────────────────────────────────────────┘   │
│  → 自動で実行、結果をreinforcement/results/claude_auto/に保存  │
│                                                                 │
│  【Grok担当】（手動・大量処理向け）                             │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ ✓ カバレッジ補強（不足ドメインの企業スキャン）         │   │
│  │ ✓ リアルタイム情報の更新                               │   │
│  │ ✓ 大量の確度補強タスク（10件以上）                     │   │
│  │ ✓ 新規候補発掘                                         │   │
│  └─────────────────────────────────────────────────────────┘   │
│  → 最速なので、数が多いタスクを優先的に割り当て                │
│                                                                 │
│  【Gemini担当】（手動・包括的分析向け）                         │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ ✓ 企業詳細の深掘り（財務、競争構造）                   │   │
│  │ ✓ 技術分析（認証、特許、モート）                       │   │
│  │ ✓ 中程度の数のタスク（5-10件）                         │   │
│  └─────────────────────────────────────────────────────────┘   │
│  → 時間がかかるため、重要度の高いタスクを厳選                  │
│                                                                 │
│  【ChatGPT担当】（手動・限定使用）                              │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ ✓ 複雑な論理分析が必要なタスク（1-3件のみ）            │   │
│  │ ✓ 他LLMで矛盾が解消できなかった場合の第三意見          │   │
│  └─────────────────────────────────────────────────────────┘   │
│  → 止まるリスクがあるため、最小限の使用に留める                │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### タスク割り当てルール

| タスク数 | 割り当て |
|---------|---------|
| 1-3件 | Claude自動 + Gemini |
| 4-10件 | Claude自動 + Grok（大半）+ Gemini（重要タスク）|
| 11件以上 | Claude自動 + Grok（全て）|

| タスクタイプ | 担当LLM | 理由 |
|-------------|---------|------|
| 一次情報源確認 | **Claude（自動）** | Web検索で直接確認可能 |
| 矛盾解消 | **Claude（自動）** | 即座に検証が必要 |
| カバレッジ補強 | **Grok** | 大量スキャンが必要、最速 |
| リアルタイム更新 | **Grok** | リアルタイム情報に強い |
| 企業深掘り | **Gemini** | 包括的分析が得意 |
| 技術分析 | **Gemini** | 詳細な構造化が得意 |
| 複雑な論理分析 | **ChatGPT** | 深い分析が必要な場合のみ |

---

## コマンド一覧

### 基本コマンド

| コマンド | アクション |
|---------|----------|
| `run analysis` | フル分析（フェーズ1-9）を実行 |
| `check status` | 全ファイル状態と分析状態を表示 |
| `diff report` | 前回分析からの変更を表示 |

### 分析コマンド

| コマンド | アクション |
|---------|----------|
| `collect intelligence` | 3LLMでのインテリジェンス収集（企業+広域） |
| `integrate data` | 全LLM出力+蓄積情報+補強情報を統合 |
| `run gap analysis` | カバレッジ不足を確認、補足調査 |
| `score companies` | 5軸評価を実行 |
| `select top30` | ランク付けしTop 30 + ウォッチリストを選定 |
| `analyze market risk` | 市場リスクスコアを計算 |
| `generate report` | 最終レポートをreports/に出力 |

### 継続的改善コマンド

| コマンド | アクション |
|---------|----------|
| `show quality issues` | 情報品質レポートの改善ポイントを表示 |
| `generate reinforcement prompts` | 改善プロンプトを自動生成 |
| `run reinforcement [priority]` | 指定優先度の補強調査を実行（1/2/3/all） |
| `show pending tasks` | 未実施の補強タスクを表示 |
| `update stable [type]` | 蓄積情報を更新（permanent/quarterly/monthly） |

### パフォーマンス検証コマンド

| コマンド | アクション |
|---------|----------|
| `record predictions` | 現在の予測を記録 |
| `verify performance [period]` | 指定期間のパフォーマンス検証（1m/3m/6m/1y） |
| `show verification report` | 最新の検証レポートを表示 |

---

## フル分析プロトコル

> **【必須】フェーズ実行ルール**: 各フェーズ開始時に、OPERATIONS.mdのチェックリストをTodoWriteで展開し、全項目完了を確認してから次フェーズに進むこと。詳細: [CLAUDE.md - フェーズ実行ルール](../CLAUDE.md#フェーズ実行ルール必須)

### 「run analysis」実行時のフロー

```
┌─────────────────────────────────────────────────────────────────┐
│                     フル分析: 9フェーズ                         │
├─────────────────────────────────────────────────────────────────┤
│ Phase 1: 状態確認                    → 前回状態を把握          │
│ Phase 2: インテリジェンス収集        → 3LLM並列実行            │
│ Phase 3: 比較分析                    → 矛盾・ギャップ検出      │
│ Phase 4: 補足調査                    → Claudeで深掘り          │
│ Phase 5: 統合・確度整理              → 全情報マージ            │
│ Phase 6: 分析・評価                  → スコアリング            │
│ Phase 7: レポート生成                → 出力作成                │
│ Phase 8: 継続的改善                  → 補強タスク生成          │
│ Phase 9: 完了                        → 状態更新・push          │
└─────────────────────────────────────────────────────────────────┘
```

---

### Phase 1: 状態確認

```
目的: 前回の分析状態を把握し、継続性を確保する

1. data/state.json を読み込み
2. 前回実行日時、コンポーネント状態を確認
3. data/information_quality.json のアラートをレビュー
4. 未完了の補強タスクを確認（reinforcement/pending_tasks.json）
```

#### ✅ Phase 1 完了チェックリスト

| # | 確認項目 | 確認内容 |
|---|---------|---------|
| 1-1 | state.json確認 | 前回実行日時、最終完了フェーズを把握した |
| 1-2 | 品質アラート確認 | 前回の改善ポイントをレビューした |
| 1-3 | 未完了タスク確認 | pending_tasks.jsonの残タスクを把握した |
| 1-4 | 補強結果確認 | reinforcement/results/に新規結果があれば確認した |

---

### Phase 2: 並列インテリジェンス収集（手動 + Claude自動）

```
目的: 各プロンプトを複数LLMで実行し、冗長性と多様性を確保
※ChatGPTは遅く途中で止まるリスクがあるため使用しない

【手動実行】外部LLM（Grok + Gemini）

2-1. 企業情報（prompt_company_info.md）
   - Grok   → data/intelligence/raw/company_info/grok.md
     ※高速・広範囲の企業スキャン
   - Gemini → data/intelligence/raw/company_info/gemini.md
     ※包括的な財務・競争分析

2-2. 広域情報（prompt_broad_info.md）
   - Grok   → data/intelligence/raw/broad_info/grok.md
     ※リアルタイム市場情報、地政学、センチメント
   - Gemini → data/intelligence/raw/broad_info/gemini.md
     ※メガトレンド、政策動向（包括的）

【推奨実行順序】
1. Grok（両方のプロンプト）→ 最速なので先に完了
2. Gemini（両方のプロンプト）→ 時間がかかるので並行して開始

【自動実行】Claude

2-3. Claude情報収集（自動）
   - 企業情報 → data/intelligence/raw/company_info/claude.md
   - 広域情報 → data/intelligence/raw/broad_info/claude.md
   ※Web検索を使用して独自視点・情報源から収集
   ※外部LLM結果を待たずに並行実行

【収集ファイル合計: 6ファイル】
- company_info: grok.md, gemini.md, claude.md
- broad_info: grok.md, gemini.md, claude.md
```

#### ✅ Phase 2 完了チェックリスト

| # | 確認項目 | 確認内容 |
|---|---------|---------|
| 2-1 | Grok企業情報 | `raw/company_info/grok.md` が存在し、内容が有効 |
| 2-2 | Grok広域情報 | `raw/broad_info/grok.md` が存在し、内容が有効 |
| 2-3 | Gemini企業情報 | `raw/company_info/gemini.md` が存在し、内容が有効 |
| 2-4 | Gemini広域情報 | `raw/broad_info/gemini.md` が存在し、内容が有効 |
| 2-5 | Claude企業情報 | `raw/company_info/claude.md` を生成した |
| 2-6 | Claude広域情報 | `raw/broad_info/claude.md` を生成した |
| 2-7 | 最低3ファイル | 最低でも3つのLLM出力が揃っている |

---

### Phase 3: 比較分析

```
目的: LLM間の出力を比較し、情報の信頼性を評価する

3-1. 矛盾検出
   - 同一企業で異なる市場シェア数値
   - 同一イベントで異なる日付/内容
   - 出力: data/analysis/contradictions.json

3-2. ギャップ検出
   - LLM Aにあり、Bにない企業/情報
   - ドメインの偏り（例: 宇宙が少ない）
   - 出力: data/analysis/gaps.json

3-3. 情報確度の初期評価
   ┌─────────────────────────────────────┐
   │ 3LLM一致 → 最高確度（分析に使用）  │
   │ 2LLM一致 → 高確度（分析に使用）    │
   │ 1LLMのみ → 要検証（補足調査対象）  │
   │ 矛盾あり → 要解消（一次情報源確認）│
   └─────────────────────────────────────┘
```

#### ✅ Phase 3 完了チェックリスト

| # | 確認項目 | 確認内容 |
|---|---------|---------|
| 3-1 | 矛盾検出 | `contradictions.json` を生成/更新した |
| 3-2 | ギャップ検出 | `gaps.json` を生成/更新した |
| 3-3 | 矛盾件数記録 | 検出した矛盾件数: ___件 |
| 3-4 | ギャップ件数記録 | 検出したギャップ件数: ___件 |
| 3-5 | 確度分布記録 | 3LLM一致: ___件、2LLM一致: ___件、要検証: ___件 |

---

### Phase 4: Claude補足調査

```
目的: 矛盾を解消し、ギャップを補完する

4-1. 矛盾解消調査
   - 一次情報源（有報、TDnet、官報）で検証
   - 正しい値を特定、誤情報を除外

4-2. ギャップ補完調査
   - 不足ドメイン/企業のWeb検索
   - 見落とされた重要企業の発掘

4-3. 要検証項目の深掘り
   - 1LLMのみの情報を検証
   - 確度を上げるか、除外するか判断

4-4. 出力
   - data/intelligence/claude_supplemental.md

git commit "比較分析・補足調査完了"
```

#### ✅ Phase 4 完了チェックリスト

| # | 確認項目 | 確認内容 |
|---|---------|---------|
| 4-1 | 矛盾解消 | 全矛盾を一次情報源で検証した（解消: ___件 / 全___件） |
| 4-2 | ギャップ補完 | 重要ギャップをWeb検索で補完した |
| 4-3 | 要検証項目 | 単一LLM情報の検証/除外を判断した |
| 4-4 | 補足調査出力 | `claude_supplemental.md` を生成した |
| 4-5 | コミット | 「比較分析・補足調査完了」でコミットした |

---

### Phase 5: 統合・確度整理

```
目的: 全情報をマージし、4次元評価を付与し、stable/を更新する
```

#### 5-1. 鮮度タグによる情報分類

LLM出力から鮮度タグ（`[PERMANENT]`, `[QUARTERLY]`, `[MONTHLY]`, `[REALTIME]`）を抽出:

```
┌─────────────────────────────────────────────────────────────────────┐
│                    鮮度タグ → stable/への振り分け                    │
├─────────────────────────────────────────────────────────────────────┤
│  [PERMANENT] 認証、モート、競争構造、参入障壁                       │
│     → stable/permanent/companies.json, domains.json                 │
│                                                                     │
│  [QUARTERLY] 財務、市場シェア、ガイダンス                           │
│     → stable/quarterly/financials.json, market_share.json           │
│                                                                     │
│  [MONTHLY] 契約、投資、プロジェクト進捗                             │
│     → stable/monthly/contracts.json, investments.json               │
│                                                                     │
│  [REALTIME] 速報、センチメント                                      │
│     → 分析に直接使用（stableには保存しない）                        │
└─────────────────────────────────────────────────────────────────────┘
```

#### 5-2. 全情報をマージ

```
【重要】stable/と今回LLM収集の関係:

stable/は「ベースライン」として使用し、LLM収集で「変化」を検知する。
変化が検出された場合は、検証の上でstable/を更新する。

┌─────────────────────────────────────────────────────────────────────┐
│                    変化検知によるマージ優先順位                       │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│  【静的情報】（stable/permanent優先）                                │
│  - 原子力規制委員会/国交省/防衛省認証: 取消されない限りstable/を使用                    │
│  - 参入障壁: 構造的要因は年単位で安定                               │
│  → LLMが「認証取消」「新規競合参入」を報告した場合のみ検証          │
│                                                                     │
│  【動的情報】（LLM収集を優先、stable/は参照値）                       │
│  - 市場シェア: 競合動向で変動可能                                   │
│  - モートの強度: 技術優位性は変動可能                               │
│  - 受注残・契約: 常に最新を優先                                     │
│  → stable/との差異を「変化アラート」として記録                      │
│                                                                     │
└─────────────────────────────────────────────────────────────────────┘

優先順位（高い順）:
1. 一次情報源で確認済み（有報、TDnet、官報）
2. 今回のLLM収集（3LLM一致）← 高確度の新規情報を優先
3. stable/permanent（認証・参入障壁等の静的情報）
4. 今回のLLM収集（2LLM一致）
5. stable/quarterly（四半期情報）
6. stable/monthly（月次情報）
7. 今回のLLM収集（単一）
8. reinforcement/results/（補強調査結果）

【マージルール】
- 同一項目は最新の情報で上書き
- 確度が高い情報を優先
- 矛盾がある場合は一次情報源で解消
- 【新規】stable/とLLM収集に差異がある場合は「変化アラート」を生成
```

#### 5-2b. 変化検知アラート（新規）

```
┌─────────────────────────────────────────────────────────────────────┐
│                    変化検知アラートシステム                           │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│  【検知対象】stable/とLLM収集の差異                                  │
│                                                                     │
│  1. 市場シェア変動（±5%以上）                                       │
│     stable/: NVDA 90% → LLM収集: NVDA 85%                           │
│     → アラート: 「AMDシェア拡大の可能性、検証要」                   │
│                                                                     │
│  2. モート弱体化シグナル                                            │
│     stable/: 「唯一の供給者」 → LLM: 「競合X社が参入発表」          │
│     → アラート: 「独占力低下の可能性、即時検証」                    │
│                                                                     │
│  3. 認証・契約の変更                                                 │
│     stable/: 契約継続 → LLM: 「契約終了/縮小」                       │
│     → アラート: 「収益基盤変化、優先検証」                          │
│                                                                     │
│  【アラート出力】                                                    │
│  → data/analysis/change_alerts.json                                 │
│  → 次回Phase 4で優先検証対象                                        │
│                                                                     │
│  【スコア影響】                                                      │
│  - 変化検知時は暫定的にLLM収集値を使用                               │
│  - Phase 4で検証後、stable/を更新                                    │
│  - 未検証の変化は「要注意」フラグでTop30に反映                       │
│                                                                     │
└─────────────────────────────────────────────────────────────────────┘
```

#### 5-3. 4次元評価を付与

```
- 確実性（噂→実行済: 10-99点）
- 検証（一次確認済→単一未検証）
- 非対称性（0-20点）
- 鮮度（有効期間）
```

#### 5-4. 情報確度マトリックス

```
┌─────────────┬─────────────┬─────────────┬─────────────┐
│ 最高確度    │ 高確度      │ 中確度      │ 要注意      │
│ (一次確認済)│ (3LLM一致)  │ (2LLM一致)  │ (単一/矛盾) │
├─────────────┼─────────────┼─────────────┼─────────────┤
│ 重み: 100%  │ 重み: 95%   │ 重み: 80%   │ 重み: 50%   │
└─────────────┴─────────────┴─────────────┴─────────────┘
```

#### 5-5. stable/の更新（重要）

```
┌─────────────────────────────────────────────────────────────────┐
│            Phase 5: consolidated → stable 更新フロー             │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  consolidated_companies.json                                    │
│  consolidated_broad.json                                        │
│           ↓                                                     │
│  【自動判定】各情報の鮮度タグを確認                              │
│           ↓                                                     │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ [PERMANENT] → stable/permanent/ 更新                    │   │
│  │   - companies.json: モート、認証、競争構造               │   │
│  │   - domains.json: ドメイン構造                          │   │
│  │   ※ 変更がある場合のみ更新（安定性重視）                │   │
│  ├─────────────────────────────────────────────────────────┤   │
│  │ [QUARTERLY] → stable/quarterly/ 更新                    │   │
│  │   - financials.json: 売上、利益、ガイダンス             │   │
│  │   - market_share.json: 市場シェア                       │   │
│  │   ※ 決算発表後に自動更新                               │   │
│  ├─────────────────────────────────────────────────────────┤   │
│  │ [MONTHLY] → stable/monthly/ 更新                        │   │
│  │   - contracts.json: 新規契約                            │   │
│  │   - investments.json: 投資発表                          │   │
│  │   ※ 毎回更新、古いものはクリーニング                   │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│  【フィードバックループ】                                        │
│  stable/ → 次回Phase 5のマージ優先順位で再利用                  │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

**【更新ルール】**

| ディレクトリ | 更新条件 | 更新内容 |
|-------------|---------|---------|
| `permanent/` | 新規・変更のみ | 認証、モート、競争構造、参入障壁 |
| `quarterly/` | 四半期決算後 | 財務、市場シェア、ガイダンス |
| `monthly/` | 毎回 | 契約、投資、プロジェクト進捗 |

**【クリーニングルール】**

| ディレクトリ | 保持期間 | アクション |
|-------------|---------|-----------|
| `quarterly/` | 6ヶ月 | 古いデータは削除 |
| `monthly/` | 3ヶ月 | 削除 or permanent昇格（重要なもの） |

#### ✅ Phase 5 完了チェックリスト

| # | 確認項目 | 確認内容 |
|---|---------|---------|
| 5-1 | 企業統合 | `consolidated_companies.json` を生成した（___社） |
| 5-2 | 広域統合 | `consolidated_broad.json` を生成した（___項目） |
| 5-3 | permanent更新 | 新規PERMANENT情報を `stable/permanent/` に追加した |
| 5-4 | quarterly更新 | 新規QUARTERLY情報を `stable/quarterly/` に更新した |
| 5-5 | monthly更新 | 新規契約を `stable/monthly/contracts.json` に追加した |
| 5-6 | クリーニング | 3ヶ月以上古いmonthly/データを削除/昇格した |
| 5-7 | コミット | 「統合完了: N社、M情報項目、stable更新」でコミットした |

#### 5-6. 出力

```
- data/intelligence/consolidated_companies.json
- data/intelligence/consolidated_broad.json
- stable/*（更新されたファイル）

git commit "統合完了: N社、M情報項目、stable更新"
```

---

### Phase 6: 分析・評価

```
目的: 統合データから候補を評価し、Top 30を選定する

6-1. 候補プール作成
   - 統合データから50社
   - ドメインカバレッジバランスを確認

6-2. 市場リスク分析（METHODOLOGY.mdに従う）
   - Tier別8カテゴリースコアリング（100点）
   - data/analysis/market_risk.json

6-3. 国際情勢評価
   - 地政学リスク評価
   - 政策変更リスク評価

6-4. Top 30スコアリング（METHODOLOGY.mdに従う）
   - 5軸評価（100点）
   - 情報確度を考慮した重み付け
   - 50社をランク付け → Top 30 + ウォッチリスト
   - data/analysis/top30.json

6-5. シナリオ分析
   - ベース/ブル/ベアの3シナリオ
   - 各シナリオでのTop30影響評価
```

#### ✅ Phase 6 完了チェックリスト

| # | 確認項目 | 確認内容 |
|---|---------|---------|
| 6-1 | 候補プール | 50社以上の候補をリストアップした |
| 6-2 | 市場リスク | `market_risk.json` を生成した（スコア: ___/100） |
| 6-3 | 国際情勢 | 4地域（日中、台湾、中東、米国政策）を評価した |
| 6-4 | Top 30選定 | `top30.json` を生成した（30社 + ウォッチリスト） |
| 6-5 | 5軸スコア | 全Top 30銘柄の5軸スコアを算出した |
| 6-6 | シナリオ分析 | ベース/ブル/ベアの3シナリオを作成した |
| 6-7 | ドメインバランス | 6ドメインのカバレッジを確認した |

---

### Phase 7: レポート生成

```
目的: 分析結果を読みやすい形式で出力する
```

#### 7-1. 最終レポート（final_report.md）

**必須9部構成**（この構成は毎回維持すること）:

```
┌─────────────────────────────────────────────────────────────────────────┐
│ 第1部: 市場環境評価                                                      │
│   ├── 1.1 市場リスクスコア表（8カテゴリ、前回比付き）                   │
│   ├── 📊 推奨投資スタンス（スコア範囲表 + 具体的行動指針）【必須】     │
│   ├── 1.2 歴史的類似                                                    │
│   └── 1.3 シナリオ分析（ベース/ブル/ベア）                              │
├─────────────────────────────────────────────────────────────────────────┤
│ 第2部: 国際情勢評価【必須】                                              │
│   ├── 日中関係（評価: 🟢🟡🟠）                                          │
│   ├── 台湾海峡（評価: 🟢🟡🟠）                                          │
│   ├── 中東・エネルギー（評価: 🟢🟡🟠）                                  │
│   └── 欧州・ウクライナ（評価: 🟢🟡🟠）                                  │
│   ※鎮静化した地域も「落ち着いている」と明記                             │
├─────────────────────────────────────────────────────────────────────────┤
│ 第3部: 重要な新規情報                                                    │
│   └── 今回収集した重要な情報（企業固有、契約、政策等）                  │
├─────────────────────────────────────────────────────────────────────────┤
│ 第4部: 6ドメイン成長予測                                                 │
│   └── ドメイン別市場規模・CAGR・ボトルネック                           │
├─────────────────────────────────────────────────────────────────────────┤
│ 第5部: 大型投資パイプライン                                              │
│   └── ハイパースケーラーCapEx、防衛予算、主要プロジェクト              │
├─────────────────────────────────────────────────────────────────────────┤
│ 第6部: Top 30 銘柄詳細【必須】                                           │
│   ├── 象限別分布                                                        │
│   ├── Top 30 一覧（5軸スコア内訳 + 今回の更新）【必須】                │
│   └── ウォッチリスト（ステータス付き）【必須】                         │
├─────────────────────────────────────────────────────────────────────────┤
│ 第7部: 重大な発見【必須】                                                │
│   └── 継続監視事項 + 新規発見事項（発見日、詳細、影響、ステータス）    │
├─────────────────────────────────────────────────────────────────────────┤
│ 第8部: 監視項目                                                          │
│   ├── 短期（1-3ヶ月）                                                   │
│   ├── 中期（3-6ヶ月）                                                   │
│   └── 長期（6-12ヶ月）                                                  │
├─────────────────────────────────────────────────────────────────────────┤
│ 第9部: 前回からの変更サマリー                                            │
│   └── 主要項目の前回比較表                                              │
└─────────────────────────────────────────────────────────────────────────┘
```

**投資スタンス表示（第1部に必須）**:

```markdown
### 📊 推奨投資スタンス: [スタンス名]（[英語名]）

> | スコア範囲 | スタンス | 現在 |
> |-----------|---------|:----:|
> | 0-25 | アグレッシブ（攻め） | |
> | 26-50 | バランス（均衡） | |
> | 51-75 | 保守的（守り） | ◀ |
> | 76-100 | ディフェンシブ（防御） | |
>
> **具体的行動指針**:
> - **ターゲット企業**: [スタンスに応じた推奨]
> - **ポジション管理**: [スタンスに応じた推奨]
> - **キャッシュ比率**: [スタンスに応じた推奨]
> - **リスク管理**: [スタンスに応じた推奨]
```

#### 7-2. エグゼクティブサマリー（executive_summary.md）

- 市場リスクスコア表 + 投資スタンス表（簡潔版）
- 主要マクロ指標
- Top 5 コンビクション銘柄
- 重要な新規情報（ハイライト）
- 前回からの変更点

#### 7-3. 情報品質レポート

```
   - reports/[TODAY]/information_quality_report.md
   - 使用情報源、確度分布、矛盾解消記録
   - 【重要】改善ポイントの特定:
     ┌────────────────────────────────────────┐
     │ 品質分析項目:                          │
     │ - カバレッジ不足（ドメイン/企業）      │
     │ - 確度不足（単一情報源のみ）           │
     │ - 矛盾未解消                           │
     │ - 深さ不足（表面的情報のみ）           │
     │ - 鮮度切れ（要更新情報）               │
     └────────────────────────────────────────┘
```

#### 7-4. HTML可視化

- reports/[TODAY]/quadrant_chart.html
- 4象限マトリックス（確実性 × アップサイド）

#### 7-5. latest/にコピー

```
git commit "レポート生成完了"
```

#### ✅ Phase 7 完了チェックリスト

| # | 確認項目 | 確認内容 |
|---|---------|---------|
| 7-1 | 最終レポート | `reports/[DATE]/final_report.md` を生成した（9部構成） |
| 7-2 | サマリー | `reports/[DATE]/executive_summary.md` を生成した |
| 7-3 | 品質レポート | `reports/[DATE]/information_quality_report.md` を生成した |
| 7-4 | 象限チャート | `reports/[DATE]/quadrant_chart.html` を生成した |
| 7-5 | latest更新 | `latest/` フォルダを更新した |
| 7-6 | 品質スコア | 全体品質スコア: ___/100 |
| 7-7 | 要改善カテゴリ | スコア<85のカテゴリ: ___ |
| 7-8 | コミット | 「レポート生成完了」でコミットした |

---

### Phase 8: 継続的改善（Claude自動補強 + 外部LLMタスク生成）

```
目的: 情報品質レポートから改善タスクを生成し、プロンプトを改善する

┌─────────────────────────────────────────────────────────────────┐
│        Phase 8: 品質レポート → プロンプト改善フロー              │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  reports/[DATE]/information_quality_report.md                   │
│           ↓                                                     │
│  【弱点特定】                                                    │
│  - カバレッジ不足（例: 見逃しスキャン 75/100）                   │
│  - 確度不足（単一情報源のみ）                                   │
│  - 矛盾未解消                                                   │
│  - 検出遅延（大型契約の見落とし等）                             │
│           ↓                                                     │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ 【収集プロンプト改善】prompts/grok/, prompts/gemini/     │   │
│  │ - 弱点カテゴリの強化（例: カテゴリF見逃しスキャン）       │   │
│  │ - 新規収集ポイントの追加                                  │   │
│  │ - 出力形式の詳細化                                        │   │
│  │ → 次回Phase 2の情報収集品質が向上                        │   │
│  └─────────────────────────────────────────────────────────┘   │
│           ↓                                                     │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ 【補強プロンプト生成】reinforcement/prompts/             │   │
│  │ - Grok用: カバレッジ補強、リアルタイム更新               │   │
│  │ - Gemini用: 企業深掘り、技術分析                         │   │
│  │ → 次回分析前に手動実行（オプション）                     │   │
│  └─────────────────────────────────────────────────────────┘   │
│           ↓                                                     │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ 【学習記録】reinforcement/learnings/[DATE].json          │   │
│  │ - 精度トラッキング                                        │   │
│  │ - プロンプト改善履歴                                      │   │
│  │ - 次回検証項目                                            │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

**【品質レポート → 改善の対応表】**

| 品質レポートの問題 | 改善アクション | 出力先 |
|------------------|--------------|--------|
| カテゴリスコア < 85 | 該当カテゴリの収集プロンプト強化 | `prompts/*/broad_info.md` |
| 未解消ギャップ | 補強タスク生成 | `reinforcement/prompts/` |
| 検出遅延 | 監視ポイント追加 | `prompts/*/broad_info.md` |
| 矛盾未解消 | Claude自動検証タスク | `reinforcement/results/claude_auto/` |
| 確度不足 | 複数ソース検証を必須化 | `prompts/*/チェックリスト` |

```
目的: 情報品質レポートから改善タスクを生成し、Claudeが自動補強を実施する

═══════════════════════════════════════════════════════════════════
8-1. Claude自動補強（即時実行）
═══════════════════════════════════════════════════════════════════

情報品質レポートで以下が検出された場合、Claudeが自動でWeb検索・補強:

【自動補強対象】
┌────────────────────────────────────────────────────────────────┐
│ ✓ 一次情報源での検証が必要な項目                              │
│   → 有報、TDnet、官報, 官報で直接確認            │
│                                                                │
│ ✓ 矛盾が検出された数値・情報                                  │
│   → Web検索で正しい値を特定、誤情報を除外                    │
│                                                                │
│ ✓ 高非対称性（スコア13+）の情報                               │
│   → 追加検証で確度を上げる                                    │
│                                                                │
│ ✓ Top 30候補の単一情報源項目                                  │
│   → 重要度が高いため優先的に検証                              │
└────────────────────────────────────────────────────────────────┘

【出力】
→ reinforcement/results/claude_auto/[DATE].md
→ 結果は自動でconsolidated_*.jsonに統合

═══════════════════════════════════════════════════════════════════
8-2. 外部LLM用プロンプト生成（手動実行用）
═══════════════════════════════════════════════════════════════════

Claude自動補強で対応できないタスクをLLM別に振り分け:

【Grok用】reinforcement/prompts/grok/
┌────────────────────────────────────────────────────────────────┐
│ - カバレッジ補強（不足ドメインの企業スキャン）                │
│ - リアルタイム情報の更新                                      │
│ - 大量の確度補強タスク（10件以上）                            │
│ - 新規候補発掘                                                │
└────────────────────────────────────────────────────────────────┘

【Gemini用】reinforcement/prompts/gemini/
┌────────────────────────────────────────────────────────────────┐
│ - 企業詳細の深掘り（財務、競争構造）                          │
│ - 技術分析（認証、特許、モート）                              │
│ - 重要度の高い確度補強（5-10件）                              │
└────────────────────────────────────────────────────────────────┘

【ChatGPT用】reinforcement/prompts/chatgpt/（限定使用）
┌────────────────────────────────────────────────────────────────┐
│ - 複雑な論理分析が必要なタスク（1-3件のみ）                   │
│ - 他LLMで矛盾が解消できなかった場合の第三意見                 │
└────────────────────────────────────────────────────────────────┘

═══════════════════════════════════════════════════════════════════
8-3. 補強タスクの優先順位付け
═══════════════════════════════════════════════════════════════════

   - 優先度1: Claude自動 + Grok（緊急タスク）
   - 優先度2: Grok + Gemini（週次タスク）
   - 優先度3: Grok（月次タスク）
   → reinforcement/pending_tasks.json（LLM割り当て情報を含む）

git commit "Claude自動補強完了・外部LLMタスク生成"
```

#### ✅ Phase 8 完了チェックリスト

| # | 確認項目 | 確認内容 |
|---|---------|---------|
| 8-1 | Claude自動補強 | `reinforcement/results/claude_auto/[DATE].md` を生成した |
| 8-2 | 学習記録 | `reinforcement/learnings/[DATE].json` を生成した |
| 8-3 | 収集プロンプト改善 | スコア<85のカテゴリのプロンプトを強化した |
| 8-4 | Grokタスク生成 | `reinforcement/prompts/grok/[DATE]_tasks.md` を生成した（該当あれば） |
| 8-5 | Geminiタスク生成 | `reinforcement/prompts/gemini/[DATE]_tasks.md` を生成した（該当あれば） |
| 8-6 | pending更新 | `reinforcement/pending_tasks.json` を更新した |
| 8-7 | 改善ID記録 | 今回のプロンプト改善ID: PI-___ |
| 8-8 | コミット | 「Claude自動補強完了・外部LLMタスク生成」でコミットした |

---

### Phase 9: 完了

```
目的: 状態を更新し、分析サイクルを完了する

- state.json を更新
- latest/ フォルダを更新
- 次回分析への引き継ぎ情報を記録
- 予測記録（パフォーマンス検証用）
  → data/performance/predictions/[TODAY]/
- git commit & push
```

#### ✅ Phase 9 完了チェックリスト

| # | 確認項目 | 確認内容 |
|---|---------|---------|
| 9-1 | state.json | `data/state.json` を更新した（日時、完了フェーズ） |
| 9-2 | latest更新 | `latest/` を最新レポートで更新した |
| 9-3 | 予測記録 | `data/performance/predictions/[DATE]/` を作成した（オプション） |
| 9-4 | 最終コミット | 全変更をコミットした |
| 9-5 | プッシュ | リモートにプッシュした |
| 9-6 | 次回引継ぎ | 次回分析への監視項目を記録した |

---

### 📋 フル分析完了サマリーテンプレート

フル分析終了時に以下を記録:

```markdown
## フル分析完了サマリー: [DATE]

### 実行結果
| フェーズ | 状態 | 備考 |
|---------|------|------|
| Phase 1 | ✅ | - |
| Phase 2 | ✅ | Grok/Gemini/Claude 6ファイル |
| Phase 3 | ✅ | 矛盾___件、ギャップ___件 |
| Phase 4 | ✅ | 矛盾解消___件 |
| Phase 5 | ✅ | ___社統合、stable更新 |
| Phase 6 | ✅ | 市場リスク___/100 |
| Phase 7 | ✅ | 品質スコア___/100 |
| Phase 8 | ✅ | PI-___実施 |
| Phase 9 | ✅ | push完了 |

### 主要アウトプット
- 市場リスクスコア: ___/100（前回比: ±___）
- 情報品質スコア: ___/100
- Top 30変動: 追加___社、除外___社
- プロンプト改善: PI-___

### 次回への引継ぎ
- 監視項目: ___
- 未完了タスク: ___
```

---

### オプション: 補強調査の継続実行（手動）

```
フル分析後、時間がある場合:

1. pending.json からLLM別のタスクを確認
   - grok_tasks: 大量タスク、カバレッジ補強
   - gemini_tasks: 企業深掘り、技術分析
   - chatgpt_tasks: 複雑な論理分析（限定）

2. 推奨実行順序:
   ┌────────────────────────────────────────────────────┐
   │ 1. Grok → 最速、大量タスクを先に処理              │
   │ 2. Gemini → 時間がかかるが重要タスクを処理        │
   │ 3. ChatGPT → 必要な場合のみ（止まるリスクあり）   │
   └────────────────────────────────────────────────────┘

3. 結果を reinforcement/results/[LLM]/ に保存
   - reinforcement/results/grok/[DATE].md
   - reinforcement/results/gemini/[DATE].md
   - reinforcement/results/chatgpt/[DATE].md

4. 次回フル分析で自動統合
```

---

## フェーズ独立性と部分再実行

### フェーズ独立性の設計

各フェーズは独立して実行可能。入力と出力が明確に定義されている。

```
┌─────────────────────────────────────────────────────────────────────────┐
│                         フェーズ依存関係図                               │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  Phase 1 ────→ Phase 2 ────→ Phase 3 ────→ Phase 4                     │
│  (状態確認)    (収集)        (比較)        (補足)                       │
│      ↓            ↓            ↓            ↓                          │
│  state.json   raw/*.md    contradictions  claude_                       │
│                           gaps.json       supplemental                  │
│                                              ↓                          │
│                           Phase 5 ←─────────┘                          │
│                           (統合)                                        │
│                              ↓                                          │
│                      consolidated_*.json                                │
│                              ↓                                          │
│  Phase 6 ←───────────────────┘                                         │
│  (分析)                                                                 │
│      ↓                                                                  │
│  market_risk.json, top30.json                                          │
│      ↓                                                                  │
│  Phase 7 ────→ Phase 8 ────→ Phase 9                                   │
│  (レポート)    (改善)        (完了)                                     │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

### フェーズ入出力定義

| Phase | 入力ファイル | 出力ファイル | 独立実行条件 |
|-------|-------------|-------------|-------------|
| 1 | - | state.json（読取） | 常に可能 |
| 2 | prompts/*.md | raw/*.md | 常に可能 |
| 3 | raw/*.md | contradictions.json, gaps.json | Phase 2完了 |
| 4 | contradictions.json, gaps.json | claude_supplemental.md | Phase 3完了 |
| 5 | raw/*.md, claude_supplemental.md, stable/* | consolidated_*.json | Phase 2,4完了 |
| 6 | consolidated_*.json | market_risk.json, top30.json | Phase 5完了 |
| 7 | top30.json, market_risk.json | reports/* | Phase 6完了 |
| 8 | information_quality_report.md | reinforcement/* | Phase 7完了 |
| 9 | 全出力 | state.json（更新） | Phase 7完了 |

### 部分再実行コマンド

```bash
# 特定フェーズから再開（それ以降を全て実行）
run analysis --from 5    # Phase 5から再開
run analysis --from 6    # Phase 6から再開

# 特定フェーズのみ再実行
run phase 2              # Phase 2のみ再実行
run phase 6              # Phase 6のみ再実行

# 複数フェーズを指定
run phases 3,4           # Phase 3と4のみ再実行
run phases 6-8           # Phase 6,7,8を再実行
```

### 部分再実行のユースケース

| ユースケース | コマンド | 説明 |
|-------------|---------|------|
| 外部LLM結果を追加 | `run analysis --from 3` | 新しいraw/*.mdを追加後、Phase 3から再開 |
| スコアリングロジック変更 | `run phases 6-7` | 評価基準変更後、再スコアリング |
| レポート形式変更 | `run phase 7` | レポートテンプレート変更後 |
| 補強情報の反映 | `run analysis --from 5` | 補強結果追加後、統合から再開 |

### エラーリカバリー

```
┌─────────────────────────────────────────────────────────────────┐
│                    エラーリカバリーフロー                        │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  エラー発生 at Phase N                                          │
│       ↓                                                         │
│  state.json に記録                                              │
│  - last_completed_phase: N-1                                   │
│  - error_phase: N                                              │
│  - error_message: "..."                                        │
│       ↓                                                         │
│  次回実行時:                                                    │
│  - `run analysis` → Phase N から自動再開                       │
│  - `run analysis --from 1` → 強制的に最初から                  │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### チェックポイント機能

各フェーズ完了時にチェックポイントを保存:

```json
// data/checkpoints/checkpoint_phase5_20250127.json
{
  "phase": 5,
  "timestamp": "2025-01-27T15:30:00Z",
  "outputs": {
    "consolidated_companies": "hash:abc123",
    "consolidated_broad": "hash:def456"
  },
  "status": "completed"
}
```

---

## 並列実行の最適化

### LLM並列実行（Phase 2）

```
┌─────────────────────────────────────────────────────────────────┐
│                 Phase 2: 並列実行パターン                        │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  【最大並列化パターン】                                         │
│                                                                 │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐            │
│  │    Grok     │  │   Gemini    │  │   Claude    │            │
│  │  (最速)     │  │  (やや遅)   │  │  (自動)     │            │
│  ├─────────────┤  ├─────────────┤  ├─────────────┤            │
│  │ broad_info  │  │ company_deep│  │ Web検索     │            │
│  │ company_scan│  │ broad_info  │  │ (独自収集)  │            │
│  └─────────────┘  └─────────────┘  └─────────────┘            │
│        ↓                ↓                ↓                     │
│   [完了予想: 5分]  [完了予想: 15分]  [完了予想: 10分]          │
│                                                                 │
│  全完了後 → Phase 3 開始                                        │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### タスクスケジューラー連携

Grok/Geminiはタスクスケジューラーで定期実行可能:

```
┌─────────────────────────────────────────────────────────────────┐
│                タスクスケジューラー設定例                        │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  【週次スケジュール（推奨: 日曜夜）】                           │
│                                                                 │
│  22:00 - Grok: prompts/grok/broad_info.md                      │
│  22:00 - Grok: prompts/grok/company_scan.md                    │
│  22:05 - Gemini: prompts/gemini/company_deep.md                │
│  22:05 - Gemini: prompts/gemini/broad_info.md                  │
│                                                                 │
│  → 出力: data/intelligence/raw/[llm]/[type]_YYYYMMDD.md        │
│                                                                 │
│  【月曜朝】                                                     │
│  - 人間がファイルを確認                                         │
│  - `run analysis --from 3` で分析開始                          │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### プロンプトディレクトリ構造

LLM別に最適化されたプロンプト:

```
prompts/
├── README.md           # プロンプト概要
├── shared/             # 共通定義
│   └── definitions.md
├── grok/               # Grok用（速度重視）
│   ├── broad_info.md
│   ├── company_scan.md
│   └── reinforcement.md
├── gemini/             # Gemini用（深さ重視）
│   ├── company_deep.md
│   ├── broad_info.md
│   └── reinforcement.md
├── claude/             # Claude用（検証重視）
│   ├── contradiction_resolver.md
│   ├── primary_source_verifier.md
│   ├── high_asymmetry_verifier.md
│   └── top30_reinforcement.md
└── external/           # 旧プロンプト（参考用）
```

詳細: [prompts/README.md](../prompts/README.md)

---

## 差分追跡

### 差分検出の仕組み

```
┌─────────────────────────────────────────────────────────────────┐
│                      差分追跡システム                            │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  前回分析                     今回分析                          │
│  ────────                     ────────                          │
│  top30.json (v1)    ─────→   top30.json (v2)                   │
│                       ↓                                         │
│                  差分検出                                        │
│                       ↓                                         │
│  ┌───────────────────────────────────────────┐                 │
│  │ diff_report.json                          │                 │
│  │ - added: [新規Top30入り企業]              │                 │
│  │ - removed: [Top30から外れた企業]          │                 │
│  │ - score_changes: [スコア変動]             │                 │
│  │ - rank_changes: [順位変動]                │                 │
│  │ - new_information: [新規情報]             │                 │
│  └───────────────────────────────────────────┘                 │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### 差分レポート形式

```markdown
## 差分レポート: 2025-01-27 vs 2025-01-20

### Top 30 変動

#### 新規追加 (3社)
| Rank | Ticker | Company | Score | 理由 |
|------|--------|---------|-------|------|
| 12 | XYZ | XYZ Corp | 78 | 新規防衛契約$500M |
| ...

#### 除外 (2社)
| 前Rank | Ticker | Company | 理由 |
|--------|--------|---------|------|
| 28 | ABC | ABC Inc | スコア低下（政策リスク増） |
| ...

#### スコア変動 (Top 10)
| Rank | Ticker | 前回 | 今回 | 変動 | 主因 |
|------|--------|------|------|------|------|
| 1 | NVDA | 92 | 94 | +2 | データセンター売上増 |
| ...

### 市場リスク変動
- 前回: 42/100 (バランス)
- 今回: 48/100 (バランス)
- 変動: +6
- 主因: バリュエーション上昇

### 新規情報ハイライト
1. [重要] GX投資計画の詳細発表
2. [重要] 台湾海峡緊張度低下
3. ...
```

### 差分アラート

重要な変動は自動アラート:

| 変動タイプ | 閾値 | アラートレベル |
|-----------|------|---------------|
| Top 10企業のスコア±5以上 | 即時 | 高 |
| Top 30入れ替え | 即時 | 中 |
| 市場リスク±10以上 | 即時 | 高 |
| 新規矛盾検出 | 即時 | 中 |

---

## 情報収集プロセス

### 7つの情報カテゴリ

| # | カテゴリー | 内容 | 用途 |
|---|-----------|------|-----|
| A | **地政学** | 日中、台湾、輸出規制、経済安全保障 | 市場リスク、ドメイン評価 |
| B | **市場リスクシグナル** | 日銀政策、円相場、バリュエーション、日経VI | 市場リスク分析 |
| C | **メガトレンド** | AI設備投資、エネルギー転換、防衛支出、宇宙経済 | ドメイン成長、企業発見 |
| D | **6ドメイン成長** | ドメイン別の市場規模、成長率、投資動向 | 企業評価（シナジー） |
| E | **大型投資パイプライン** | 政府予算、企業設備投資、インフラ計画 | 企業発見、独占評価 |
| F | **見落としスキャン** | 6ドメイン外の新興領域、技術ブレークスルー | 新ドメイン候補 |
| G | **その他レポート要件** | 金利、センチメント、ポジショニング | 総合判断 |

### 情報収集原則

```
情報ファースト・アプローチ:
幅広い情報収集 → 情報から企業を発見 → 深掘り → 評価

間違い（避けるべき）:
企業リスト → それらの企業について情報収集 → 評価
```

### 変化頻度別の収集戦略

| カテゴリ | 変化頻度 | 収集タイミング | 保存場所 |
|---------|---------|---------------|---------|
| **永続情報** | 年次以下 | 初回収集後、年次確認 | `stable/permanent/` |
| **安定情報** | 四半期 | 四半期ごと更新 | `stable/quarterly/` |
| **動的情報** | 月次 | 月次更新 | `stable/monthly/` |
| **リアルタイム情報** | 週次/日次 | フル分析時に毎回 | `raw/` |

### 収集タイミングの最適化

```
┌─────────────────────────────────────────────────────────────┐
│                    情報収集の優先順位                        │
├─────────────────────────────────────────────────────────────┤
│  【初回/四半期】                                            │
│  永続情報 + 安定情報を徹底収集                              │
│  → 認証、市場シェア、競争構造、財務基盤                    │
│  → 一度固めれば次回は差分のみ                              │
│                                                             │
│  【月次】                                                   │
│  動的情報の更新 + 補強調査の実施                            │
│  → 新規契約、投資発表、プロジェクト進捗                    │
│  → 前回の情報品質レポートに基づく補強                      │
│                                                             │
│  【フル分析時】                                             │
│  リアルタイム情報を確実に収集                               │
│  → 市場センチメント、地政学リスク、最新ニュース            │
│  → 蓄積された永続/安定/動的情報と統合                      │
└─────────────────────────────────────────────────────────────┘
```

---

## 品質管理ルール

### 矛盾検出ルール

| ルール | トリガー | アクション |
|--------|---------|-----------|
| 数値乖離 | 同一企業、同一指標が10%以上乖離 | 矛盾アラート、一次情報源で検証 |
| タイムライン矛盾 | 「契約締結」の後に「交渉中」 | 日付と内容を再検証 |
| 因果矛盾 | イベント間で因果関係が矛盾 | 両情報源を再検証 |

### 陳腐化検出ルール

| 情報タイプ | 閾値 | アクション |
|-----------|------|-----------|
| 市場シェアデータ | 180日超 | 陳腐化アラート |
| 政策情報 | 実行期限経過 | 結果を確認 |
| ガイダンス | 次の決算後 | 更新必要 |
| 市場状態 | 1日超 | 各分析で更新 |

### 確実性自動調整ルール

| 条件 | 調整 |
|------|------|
| single_unverified が7日経過 | certainty.score -10% |
| 一次情報源で確認 | primary_confirmed にアップグレード、スコア +15 |
| 矛盾発見 | conflicting に変更、スコア -50% |

---

## 継続的改善サイクル

### 改善サイクルの流れ

```
┌──────────────────────────────────────────────────────────────────┐
│   フル分析                                                       │
│      ↓                                                           │
│   情報品質レポート生成                                           │
│      ↓                                                           │
│   ┌────────────────────────────────────────┐                    │
│   │ 品質レポートが特定する改善ポイント:    │                    │
│   │ - カバレッジ不足（ドメイン、企業）     │                    │
│   │ - 確度不足（単一情報源のみ）           │                    │
│   │ - 矛盾未解消（複数情報源で食い違い）   │                    │
│   │ - 深さ不足（表面的な情報のみ）         │                    │
│   └────────────────────────────────────────┘                    │
│      ↓                                                           │
│   ┌──────────────────────────────────────────────────────┐      │
│   │ 【自動】Claude自動補強                                │      │
│   │ - 一次情報源での検証（有報、TDnet、官報）            │      │
│   │ - 矛盾解消（Web検索で正しい値を特定）                │      │
│   │ - 高非対称性情報の追加検証                           │      │
│   │ → reinforcement/results/claude_auto/                 │      │
│   └──────────────────────────────────────────────────────┘      │
│      ↓                                                           │
│   ┌──────────────────────────────────────────────────────┐      │
│   │ 【手動】外部LLM用プロンプト生成                       │      │
│   │ - Grok用: カバレッジ補強、大量タスク                 │      │
│   │ - Gemini用: 企業深掘り、技術分析                     │      │
│   │ - ChatGPT用: 複雑な論理分析（限定）                  │      │
│   │ → reinforcement/prompts/[LLM]/                       │      │
│   └──────────────────────────────────────────────────────┘      │
│      ↓                                                           │
│   次回フル分析で統合                                             │
│      → 補強情報が高確度情報として組み込まれる                   │
└──────────────────────────────────────────────────────────────────┘
```

### 改善プロンプトのLLM別振り分け

| 種類 | 担当LLM | 出力先 |
|------|---------|--------|
| **一次情報源確認** | Claude（自動） | `results/claude_auto/` |
| **矛盾解消** | Claude（自動） | `results/claude_auto/` |
| **カバレッジ補強** | Grok（手動） | `prompts/grok/` |
| **リアルタイム更新** | Grok（手動） | `prompts/grok/` |
| **企業深掘り** | Gemini（手動） | `prompts/gemini/` |
| **技術分析** | Gemini（手動） | `prompts/gemini/` |
| **複雑な論理分析** | ChatGPT（手動） | `prompts/chatgpt/` |

### 補強調査の優先順位とLLM割り当て

| 優先度 | 対象 | 担当LLM | 実施タイミング |
|--------|------|---------|---------------|
| 1（即時） | 一次情報源確認、矛盾解消、高非対称性検証 | **Claude自動** | フル分析時 |
| 1（即時） | Top 30候補の緊急タスク | Grok | フル分析直後 |
| 2（週次） | カバレッジ補強、中確度不足 | Grok + Gemini | 週次 |
| 3（月次） | 深掘り、新規候補発掘 | Grok | 月次 |

### LLM精度トラッキング

Phase 8で以下の精度情報を `reinforcement/learnings/[DATE].json` に記録:

```
┌─────────────────────────────────────────────────────────────────┐
│ 精度トラッキング項目:                                           │
│                                                                 │
│ 1. 数値精度                                                     │
│    - 市場指標（VIX, CAPE, HYスプレッド）の情報源別精度          │
│    - 企業財務（受注残、売上、マージン）の情報源別精度           │
│                                                                 │
│ 2. 検出遅延                                                     │
│    - 大型契約・発表の検出までの遅延日数                         │
│    - 重要イベントの見落とし記録                                 │
│                                                                 │
│ 3. LLM別パフォーマンス                                          │
│    - Grok: 速度、カバレッジ、精度                               │
│    - Gemini: 深さ、構造分析、精度                               │
│    - Claude: 検証精度、一次情報源アクセス                       │
│                                                                 │
│ 4. プロンプト改善提案                                           │
│    - 不足した情報カテゴリ                                       │
│    - 見落としパターン                                           │
│    - 次回改善アクション                                         │
└─────────────────────────────────────────────────────────────────┘
```

### 学習ファイル構造

```
reinforcement/
├── learnings/              # 【新規】学習記録
│   └── [DATE].json         # 日次学習ファイル
│       ├── accuracy_tracking     # 数値精度記録
│       ├── detection_delays      # 検出遅延記録
│       ├── llm_performance       # LLM別パフォーマンス
│       └── prompt_improvements   # プロンプト改善提案
├── pending_tasks.json
├── results/
└── prompts/
```

### プロンプト自動改善サイクル

```
┌─────────────────────────────────────────────────────────────────┐
│ Phase 8: 継続的改善                                             │
│                                                                 │
│ 1. 精度分析                                                     │
│    - 前回収集値 vs 実際の値を比較                               │
│    - 情報源別の精度スコアを算出                                 │
│                                                                 │
│ 2. 学習記録                                                     │
│    → reinforcement/learnings/[DATE].json                        │
│                                                                 │
│ 3. プロンプト改善（自動）                                       │
│    - 収集強化ポイントを更新                                     │
│    - チェックリストに新項目追加                                 │
│    - 出力形式を最適化                                           │
│                                                                 │
│ 4. 次回分析で改善効果を検証                                     │
│    → 精度向上を定量的に追跡                                     │
└─────────────────────────────────────────────────────────────────┘
```

---

## 関連ドキュメント

- [STRATEGY.md](./STRATEGY.md) - 戦略・理念
- [METHODOLOGY.md](./METHODOLOGY.md) - 評価フレームワーク
- [TECHNICAL_SPEC.md](./TECHNICAL_SPEC.md) - 技術仕様
